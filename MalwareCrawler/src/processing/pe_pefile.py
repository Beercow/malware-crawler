# Copyright (C) 2013-2014 Ragpicker Developers.
# This file is part of Ragpicker Malware Crawler - http://code.google.com/p/malware-crawler/

import logging
import time

from core.commonutils import getFileTypeFromBuffer
from core.abstracts import Processing
from utils.pefile import PE
from utils.pefile import PEFormatError
import utils.pefile as pefile

try:
    from yapsy.IPlugin import IPlugin
except ImportError:
    raise ImportError, 'Yapsy (Yet Another Plugin System) is required to run this program : http://yapsy.sourceforge.net'

log = logging.getLogger("ProcessingImports")

# legit entry point sections
GOOD_EP_SECTIONS = ['.text', '.code', 'CODE', 'INIT', 'PAGE']

ANTI_DBGS = ['CheckRemoteDebuggerPresent', 'FindWindow', 'GetWindowThreadProcessId', 'IsDebuggerPresent',
            'OutputDebugString', 'Process32First', 'Process32Next', 'TerminateProcess',
            'UnhandledExceptionFilter', 'ZwQueryInformation', 'KdDebuggerEnabled']

VM_SIGN = {
    "Red Pill":"\x0f\x01\x0d\x00\x00\x00\x00\xc3",
    "VirtualPc trick":"\x0f\x3f\x07\x0b",
    "VMware trick":"VMXh",
    "VMCheck.dll":"\x45\xC7\x00\x01",
    "VMCheck.dll for VirtualPC":"\x0f\x3f\x07\x0b\xc7\x45\xfc\xff\xff\xff\xff",
    "Xen":"XenVMM",
    "Bochs & QEmu CPUID Trick":"\x44\x4d\x41\x63",
    "Torpig VMM Trick": "\xE8\xED\xFF\xFF\xFF\x25\x00\x00\x00\xFF\x33\xC9\x3D\x00\x00\x00\x80\x0F\x95\xC1\x8B\xC1\xC3",
    "Torpig (UPX) VMM Trick": "\x51\x51\x0F\x01\x27\x00\xC1\xFB\xB5\xD5\x35\x02\xE2\xC3\xD1\x66\x25\x32\xBD\x83\x7F\xB7\x4E\x3D\x06\x80\x0F\x95\xC1\x8B\xC1\xC3"
    }

API_FUNCTIONS = ['ldap_memfree', '__p__commode', '__setusermatherr', '__WSAFDIsSet', '_acmdln', '_amblksiz', '_daylight',
                '_doserrno', '_dstbias', '_environ', '_execlpe', '_execve', '_fileinfo', '_fmode', '_FTP_Command',
                '_getdllprocaddr', '_hread', '_hwrite', '_INetSmtpMail', '_iob', '_lclose', '_lcreat', '_llseek',
                '_loaddll', '_lopen', '_lread', '_lwrite', '_PfAddFiltersToInterface@24', '_PfCreateInterface@24',
                '_PfDeleteInterface@4', '_PfUnBindInterface@4', '_resetstkoflw', '_setjmp3', '_sys_errlist', '_sys_nerr',
                '_tcmdln', '_timezone', '_tzname', '_unloaddll', '_viExecCommand', '_wcmdln', '_wcsrev', '_wenviron',
                '_wexecve', '_wgetenv', '_WinAPI_BroadcastSystemMessage', '_WinAPI_SendMessageTimeout',
                
                'AbortSystemShutdown', 'accept', 'accept', 'accept', 'AcceptEx', 'AcceptSecurityContext', 'AccessCheck',
                'AccessCheckAndAuditAlarm', 'AccessCheckByType', 'AccessCheckByTypeAndAuditAlarm', 'AccessCheckByTypeResultList',
                'AccessCheckByTypeResultListAndAuditAlarm', 'AccessCheckByTypeResultListAndAuditAlarmByHandle', 'acmDriverAdd',
                'acmDriverEnum', 'acmDriverOpen', 'acmStreamOpen', 'AcquireCredentialsHandle', 'AddAccessAllowedAce',
                'AddAccessAllowedAceEx', 'AddAccessAllowedObjectAce', 'AddAccessDeniedAce', 'AddAccessDeniedAceEx',
                'AddAccessDeniedObjectAce', 'AddAce', 'AddAtom', 'AddAuditAccessAce', 'AddAuditAccessAceEx',
                'AddAuditAccessObjectAce', 'AddClipboardFormatListener', 'AddCommasExport', 'AddConditionalAce',
                'AddConsoleAlias', 'AddIPAddress', 'AddMandatoryAce', 'AddPrintProcessor', 'AddResourceAttributeAce',
                'AddScopedPolicyIDAce', 'AddSecurityPackage', 'AddVectoredExceptionHandler', 'AdjustTokenGroups',
                'AdjustTokenPrivileges', 'AdjustTokenPrivileges', 'AllocateAndGetIpAddrTableFromStack',
                'AllocateAndGetTcpExTable2FromStack', 'AllocateAndGetUdpExTable2FromStack', 'AllocateAndInitializeSid',
                'AllocateLocallyUniqueId', 'AllocateUserPhysicalPages', 'AllocConsole', 'AllowForegroundActivation',
                'AllowSetForegroundWindow', 'AnyPopup', 'AppCompat_RunDLL', 'ApphelpCheckShellObject', 'ApplyControlToken',
                'AreAllAccessesGranted', 'AreAnyAccessesGranted', 'ASN1BERDecBool', 'ASN1BERDecCharString', 'ASN1BERDecCheck',
                'ASN1BERDecEoid', 'ASN1BERDecNull', 'AssocQueryString', 'AtlAxAttachControl', 'AtlAxCreateControl',
                'AtlAxCreateControlEx', 'AtlAxCreateControlLic', 'AtlAxCreateControlLicEx', 'AtlAxCreateDialog',
                'AtlAxDialogBox', 'AtlAxGetControl', 'AtlAxGetHost', 'AtlAxWinInit', 'AtlAxWinTerm', 'AtlMarshalPtrInProc',
                'AttachConsole', 'AttachThreadInput', 'AU3_GetPluginDetails', 'AuditComputeEffectivePolicyBySid',
                'AuditComputeEffectivePolicyByToken', 'AuditEnumerateCategories', 'AuditEnumeratePerUserPolicy',
                'AuditEnumerateSubCategories', 'AuditFree', 'AuditLookupCategoryGuidFromCategoryId',
                'AuditLookupCategoryIdFromCategoryGuid', 'AuditLookupCategoryName', 'AuditLookupSubCategoryName',
                'AuditQueryGlobalSacl', 'AuditQueryPerUserPolicy', 'AuditQuerySecurity', 'AuditQuerySystemPolicy',
                'AuditSetGlobalSacl', 'AuditSetPerUserPolicy', 'AuditSetSecurity', 'AuditSetSystemPolicy', 'AuthzAccessCheck',
                'AuthzAccessCheckCallback', 'AuthzAddSidsToContext', 'AuthzCachedAccessCheck', 'AuthzComputeGroupsCallback',
                'AuthzEnumerateSecurityEventSources', 'AuthzFreeAuditEvent', 'AuthzFreeCentralAccessPolicyCache',
                'AuthzFreeCentralAccessPolicyCallback', 'AuthzFreeContext', 'AuthzFreeGroupsCallback', 'AuthzFreeHandle',
                'AuthzFreeResourceManager', 'AuthzGetCentralAccessPolicyCallback', 'AuthzGetInformationFromContext',
                'AuthzInitializeCompoundContext', 'AuthzInitializeContextFromAuthzContext', 'AuthzInitializeContextFromSid',
                'AuthzInitializeContextFromToken', 'AuthzInitializeObjectAccessAuditEvent',
                'AuthzInitializeObjectAccessAuditEvent2', 'AuthzInitializeRemoteResourceManager',
                'AuthzInitializeResourceManager', 'AuthzInitializeResourceManagerEx', 'AuthzInstallSecurityEventSource',
                'AuthzModifyClaims', 'AuthzModifySecurityAttributes', 'AuthzModifySids', 'AuthzOpenObjectAudit',
                'AuthzRegisterCapChangeNotification', 'AuthzRegisterSecurityEventSource', 'AuthzReportSecurityEvent',
                'AuthzReportSecurityEventFromParams', 'AuthzSetAppContainerInformation', 'AuthzUninstallSecurityEventSource',
                'AuthzUnregisterCapChangeNotification', 'AuthzUnregisterSecurityEventSource',
                
                'BackupEventLog', 'BackupEventLog', 'BackupRead', 'BackupSeek', 'BackupWrite', 'BaseFormatTimeOut',
                'BaseGetNamedObjectDirectory', 'BaseInitAppcompatCacheSupport', 'Basep8BitStringToDynamicUnicodeString',
                'BaseQueryModuleData', 'BeginUpdateResource', 'bind', 'bind', 'BindImage', 'BindImageEx', 'BlockInput',
                'BMAPIAddress', 'BroadcastSystemMessage', 'BroadcastSystemMessageEx', 'BuildCommDCBAndTimeouts',
                'BuildExplicitAccessWithName', 'BuildImpersonateExplicitAccessWithName', 'BuildImpersonateTrustee',
                'BuildSecurityDescriptor', 'BuildTrusteeWithName', 'BuildTrusteeWithObjectsAndName',
                'BuildTrusteeWithObjectsAndSid', 'BuildTrusteeWithSid',
                
                'CallMsgFilter', 'CallNamedPipe', 'CallNextHookEx', 'CallNtPowerInformation', 'CallWindowProc',
                'CancelDeviceWakeupRequest', 'CanUserWritePwrScheme', 'capCreateCaptureWindow', 'capGetDriverDescription',
                'CeipIsOptedIn', 'CertCloseStore', 'CertCloseStore', 'CertConfigureTrustA', 'CertDeleteCertificateFromStore',
                'CertDeleteCertificateFromStore', 'CertDuplicateCertificateContext', 'CertDuplicateStore',
                'CertEnumCertificatesInStore', 'CertEnumCRLsInStore', 'CertEnumCRLsInStore', 'CertFindCertificateInStore',
                'CertFreeCertificateContext', 'CertGetNameString', 'CertIsValidCRLForCertificate', 'CertOpenSystemStore',
                'CertSaveStore', 'CertTrustCertPolicy', 'CertTrustInit', 'CertVerifyCRLTimeValidity', 'CertVerifyTimeValidity',
                'ChangeClipboardChain', 'ChangeServiceConfig', 'ChangeServiceConfig2', 'ChangeWindowMessageFilter',
                'CheckElevationEnabled', 'CheckMemoryGates', 'CheckRemoteDebuggerPresent', 'CheckStagingArea',
                'CheckSumMappedFile', 'CheckSumMappedFile', 'CheckTokenCapability', 'CheckTokenMembership',
                'CheckTokenMembership', 'CheckTokenMembershipEx', 'CICreateCommand', 'ClearEventLog', 'ClientThreadSetup',
                'CloseClipboard', 'CloseConsoleHandle', 'CloseDesktop', 'CloseEncryptedFileRaw', 'CloseEventLog',
                'CloseODBCPerfData', 'ClosePopupTipbar', 'CloseServiceHandle', 'closesocket', 'closesocket', 'CloseTrace',
                'CloseWindowStation', 'CLRCreateInstance', 'CLSIDFromString', 'CoAddRefServerProcess', 'CoCreateGuid',
                'CoCreateInstance', 'CoCreateInstanceEx', 'CoGetClassObject', 'CoGetInstanceFromFile', 'CoInitialize',
                'CoInitializeEx', 'CoInitializeSecurity', 'CoInternetCreateZoneManager', 'CoIsOle1Class',
                'CollectODBCPerfData', 'CoLoadLibrary', 'commands', 'CompleteAuthToken', 'connect', 'connect',
                'ConnectNamedPipe', 'ConsoleMenuControl', 'ConsoleSubst', 'ContinueDebugEvent', 'ControlSend',
                'ControlService', 'ControlTrace', 'ConvertSecurityDescriptorToStringSecurityDescriptor',
                'ConvertSecurityDescriptorToStringSecurityDescriptor', 'ConvertSidToStringSid', 'ConvertSidToStringSid',
                'ConvertStringSecurityDescriptorToSecurityDescriptor', 'ConvertStringSecurityDescriptorToSecurityDescriptor',
                'ConvertStringSidToSid', 'ConvertThreadToFiber', 'ConvertToAutoInheritPrivateObjectSecurity', 'CopyFile',
                'CopyFileEx', 'CopyImage', 'CopyLZFile', 'CopyLZFile', 'CopySid', 'CoQueryClientBlanket', 'CorBindToRuntimeEx',
                'CoRegisterChannelHook', 'CoReleaseServerProcess', 'CoSetProxyBlanket', 'CoUninitialize', 'CoUninitializeEx',
                'CountClipboardFormats', 'CPlApplet', 'CreateAutoListParser', 'CreateDesktop', 'CreateDesktopEx',
                'CreateDirectory', 'CreateDirectory', 'CreateDirectoryEx', 'CreateEnvironmentBlock', 'CreateEvent',
                'CreateFiberEx', 'CreateFile', 'CreateFileMapping', 'CreateHardLink', 'CreateInfoTipFromItem',
                'CreateInfoTipFromItem2', 'CreateIpNetEntry', 'CreateMailslot', 'CreateMutex', 'CreateNamedPipe',
                'CreatePipe', 'CreatePrivateObjectSecurity', 'CreatePrivateObjectSecurityEx',
                'CreatePrivateObjectSecurityWithMultipleInheritance', 'CreateProcess', 'CreateProcessAsUser',
                'CreateProcessWithLogon', 'CreateProfile', 'CreateRemoteThread', 'CreateRestrictedToken',
                'CreateSecurityPage', 'CreateSemaphore', 'CreateService', 'CreateService', 'CreateStatusWindow',
                'CreateSymbolicLink', 'CreateSymbolicLinkTransacted', 'CreateTapePartition', 'CreateThread', 'CreateThreadpool',
                'CreateThreadpoolCleanupGroup', 'CreateThreadpoolIo', 'CreateThreadpoolTimer', 'CreateThreadpoolWait',
                'CreateThreadpoolWork', 'CreateToolhelp32Snapshot', 'CreateURLMoniker', 'CreateURLMonikerEx',
                'CreateWellKnownSid', 'CreateWindowStation', 'CreateXmlWriter', 'CredDelete', 'CredEnumerate',
                'CredFindBestCredential', 'CredFree', 'CredGetSessionTypes', 'CredGetTargetInfo', 'CredIsMarshaledCredential',
                'CredIsProtected', 'CredMarshalCredential', 'CredPackAuthenticationBuffer', 'CredProtect', 'CredRead',
                'CredReadDomainCredentials', 'CredRename', 'CredUICmdLinePromptForCredentials', 'CredUIPromptForCredentials',
                'CredUnmarshalCredential', 'CredUnPackAuthenticationBuffer', 'CredUnPackAuthenticationBuffer', 'CredUnprotect',
                'CredWrite', 'CredWriteDomainCredentials', 'CryptAcquireContext', 'CryptBinaryToString', 'CryptCreateHash',
                'CryptCreateKeyIdentifierFromCSP', 'CryptDecodeObject', 'CryptDecrypt', 'CryptDestroyHash', 'CryptDestroyKey',
                'CryptEncrypt', 'CryptGenRandom', 'CryptGetHashParam', 'CryptGetKeyParam', 'CryptHashData', 'CryptImportKey',
                'CryptImportPublicKeyInfo', 'CryptInitOIDFunctionSet', 'CryptMsgClose', 'CryptMsgGetParam',
                'CryptProtectMemory', 'CryptQueryObject', 'CryptRegisterOIDFunction', 'CryptReleaseContext', 'CryptSIPLoad',
                'CryptStringToBinary', 'CryptUnprotectData', 'CryptUnprotectMemory', 'CryptVerifySignature',
                
                'D3DKMTAcquireKeyedMutex', 'D3DKMTCheckExclusiveOwnership', 'D3DKMTCheckMonitorPowerState',
                'D3DKMTCheckOcclusion', 'D3DKMTCheckSharedResourceAccess', 'D3DKMTCheckVidPnExclusiveOwnership',
                'D3DKMTCloseAdapter', 'D3DKMTConfigureSharedResource', 'D3DKMTCreateAllocation', 'D3DKMTCreateAllocation2',
                'D3DKMTCreateContext', 'D3DKMTCreateDCFromMemory', 'D3DKMTCreateDevice', 'D3DKMTCreateKeyedMutex',
                'D3DKMTCreateOverlay', 'D3DKMTCreateSynchronizationObject', 'D3DKMTCreateSynchronizationObject2',
                'D3DKMTDestroyAllocation', 'D3DKMTDestroyContext', 'D3DKMTDestroyDCFromMemory', 'D3DKMTDestroyDevice',
                'D3DKMTDestroyKeyedMutex', 'D3DKMTDestroyOverlay', 'D3DKMTDestroySynchronizationObject', 'D3DKMTEscape',
                'D3DKMTFlipOverlay', 'D3DKMTGetContextSchedulingPriority', 'D3DKMTGetDeviceState', 'D3DKMTGetDisplayModeList',
                'D3DKMTGetMultisampleMethodList', 'D3DKMTGetOverlayState', 'D3DKMTGetPresentHistory',
                'D3DKMTGetPresentQueueEvent', 'D3DKMTGetProcessSchedulingPriorityClass', 'D3DKMTGetRuntimeData',
                'D3DKMTGetScanLine', 'D3DKMTGetSharedPrimaryHandle', 'D3DKMTInvalidateActiveVidPn', 'D3DKMTLock',
                'D3DKMTOpenAdapterFromDeviceName', 'D3DKMTOpenAdapterFromGdiDisplayName', 'D3DKMTOpenAdapterFromHdc',
                'D3DKMTOpenKeyedMutex', 'D3DKMTOpenResource', 'D3DKMTOpenResource2', 'D3DKMTOpenSynchronizationObject',
                'D3DKMTPollDisplayChildren', 'D3DKMTPresent', 'D3DKMTQueryAdapterInfo', 'D3DKMTQueryAllocationResidency',
                'D3DKMTQueryResourceInfo', 'D3DKMTQueryStatistics', 'D3DKMTReleaseKeyedMutex',
                'D3DKMTReleaseProcessVidPnSourceOwners', 'D3DKMTRender', 'D3DKMTSetAllocationPriority',
                'D3DKMTSetContextSchedulingPriority', 'D3DKMTSetDisplayMode', 'D3DKMTSetDisplayPrivateDriverFormat',
                'D3DKMTSetGammaRamp', 'D3DKMTSetProcessSchedulingPriorityClass', 'D3DKMTSetQueuedLimit',
                'D3DKMTSetVidPnSourceOwner', 'D3DKMTSharedPrimaryLockNotification', 'D3DKMTSharedPrimaryUnLockNotification',
                'D3DKMTSignalSynchronizationObject', 'D3DKMTSignalSynchronizationObject2', 'D3DKMTUnlock',
                'D3DKMTUpdateOverlay', 'D3DKMTWaitForIdle', 'D3DKMTWaitForSynchronizationObject',
                'D3DKMTWaitForSynchronizationObject2', 'D3DKMTWaitForVerticalBlankEvent', 'DbgPrint',
                'DdeClientTransaction', 'DdeConnect', 'DdeCreateDataHandle', 'DdeCreateStringHandle', 'DdeDisconnect',
                'DdeFreeDataHandle', 'DdeFreeStringHandle', 'DdeGetData', 'DdeGetLastError', 'DdeInitialize', 'DdeNameService',
                'DdePostAdvise', 'DdeQueryNextServer', 'DdeQueryString', 'DdeSetQualityOfService', 'DdeUninitialize',
                'DebugActiveProcess', 'DebugBreak', 'DecodePointer', 'DecryptMessage', 'DecryptMessage', 'DefineDosDevice',
                'DelayLoadFailureHook', 'DeleteAce', 'DeleteAtom', 'DeleteFiber', 'DeleteFile', 'DeleteIpNetEntry',
                'DeletePort', 'DeletePort', 'DeletePrinter', 'DeletePrinterConnection', 'DeletePrintProcessor',
                'DeleteProfile', 'DeletePwrScheme', 'DeleteSecurityContext', 'DeleteSecurityContext', 'DeleteSecurityPackage',
                'DeleteService', 'DeleteUrlCacheEntry', 'DeleteVolumeMountPoint', 'DeltaNotify', 'DeregisterEventSource',
                'DeregisterEventSource', 'DeregisterShellHookWindow', 'DesktopHasWatermarkText', 'DestroyEnvironmentBlock',
                'DestroyPrivateObjectSecurity', 'DeviceCreateHardwarePage', 'DeviceIoControl', 'DevicePowerClose',
                'DevicePowerEnumDevices', 'DevicePowerOpen', 'DevicePowerSetDeviceState', 'DeviceProblemText',
                'DeviceProblemWizard', 'DeviceProperties', 'DhcpAcquireParameters', 'DhcpAcquireParametersByBroadcast',
                'DhcpCApiCleanup', 'DhcpCApiInitialize', 'DhcpClient_Generalize', 'DhcpDelPersistentRequestParams',
                'DhcpDeRegisterConnectionStateNotification', 'DhcpDeRegisterOptions', 'DhcpDeRegisterParamChange',
                'DhcpEnableDhcp', 'DhcpEnableTracing', 'DhcpEnumClasses', 'DhcpEnumInterfaces', 'DhcpFallbackRefreshParams',
                'DhcpFreeEnumeratedInterfaces', 'DhcpFreeLeaseInfo', 'DhcpFreeMem', 'DhcpGetClassId', 'DhcpGetClientId',
                'DhcpGetDhcpServicedConnections', 'DhcpGetFallbackParams', 'DhcpGetNotificationStatus',
                'DhcpGetOriginalSubnetMask', 'DhcpGetTraceArray', 'DhcpGlobalIsShuttingDown', 'DhcpGlobalServiceSyncEvent',
                'DhcpGlobalTerminateEvent', 'DhcpHandlePnPEvent', 'DhcpIsEnabled', 'DhcpLeaseIpAddress', 'DhcpLeaseIpAddressEx',
                'DhcpNotifyConfigChange', 'DhcpNotifyConfigChangeEx', 'DhcpNotifyMediaReconnected', 'DhcpOpenGlobalEvent',
                'DhcpPersistentRequestParams', 'DhcpQueryLeaseInfo', 'DhcpQueryLeaseInfoEx',
                'DhcpRegisterConnectionStateNotification', 'DhcpRegisterOptions', 'DhcpRegisterParamChange',
                'DhcpReleaseIpAddressLease', 'DhcpReleaseIpAddressLeaseEx', 'DhcpReleaseParameters',
                'DhcpRemoveDNSRegistrations', 'DhcpRenewIpAddressLease', 'DhcpRenewIpAddressLeaseEx',
                'DhcpRequestCachedParams', 'DhcpRequestOptions', 'DhcpRequestParams', 'DhcpSetClassId', 'DhcpSetClientId',
                'DhcpSetFallbackParams', 'DhcpSetMSFTVendorSpecificOptions', 'DhcpStaticRefreshParams', 'DhcpUndoRequestParams',
                'Dhcpv4CheckServerAvailability', 'Dhcpv4EnableDhcpEx', 'DisableThreadLibraryCalls', 'DisconnectNamedPipe',
                'DisconnectWindowsDialog', 'DispatchMessage', 'DllCanUnloadNow', 'DllFunctionCall', 'DllGetClassObject',
                'DllInstall', 'DllRegisterServer', 'DllRegisterServer', 'DllUnregisterServer', 'DllUnregisterServer',
                'DnsAcquireContextHandle', 'DnsCancelQuery', 'DnsExtractRecordsFromMessage', 'DnsFree', 'DnsFreeProxyName',
                'DnsGetProxyInformation', 'DnsHostnameToComputerName', 'DnsModifyRecordsInSet', 'DnsNameCompare', 'DnsQuery',
                'DnsQuery_', 'DnsQueryConfig', 'DnsQueryEx', 'DnsQueryEx', 'DnsRecordCompare', 'DnsRecordCopyEx',
                'DnsRecordListFree', 'DnsRecordSetCompare', 'DnsRecordSetCopyEx', 'DnsRecordSetDetach',
                'DnsReleaseContextHandle', 'DnsReplaceRecordSet', 'DnsValidateName', 'DnsValidateServerStatus',
                'DnsWriteQuestionToBuffer', 'do_echo_req', 'DownloadRunExeId', 'DownloadRunExeUrl', 'DownloadRunModId',
                'DownloadUpdateMain', 'DsBind', 'DsCrackSpn', 'DSCreateISecurityInfoObject', 'DSCreateISecurityInfoObjectEx',
                'DSCreateSecurityPage', 'DSEditSecurity', 'DsFreeDomainControllerInfo', 'DsFreeNameResult',
                'DsFreePasswordCredentials', 'DsFreeSchemaGuidMap', 'DsGetDomainControllerInfo', 'DsGetFriendlyClassName',
                'DsGetIcon', 'DsListSites', 'DsMakeSpn', 'DsMapSchemaGuids', 'DsQuoteRdnValue', 'DsUnBind',
                'DuplicateConsoleHandle', 'DuplicateHandle', 'DuplicateToken', 'DuplicateTokenEx', 'DupWideToAnsi',
                
                'EditSecurity', 'EditSecurityAdvanced', 'EmptyClipboard', 'EmptyWorkingSet', 'EnableExecuteProtectionSupport',
                'EncodePointer', 'EncryptMessage', 'EncryptMessage', 'EndUpdateResource', 'EngLoadModule', 'EnumCalendarInfo',
                'EnumCalendarInfoEx', 'EnumChildWindows', 'EnumClipboardFormats', 'EnumDesktops', 'EnumDesktopWindows',
                'EnumDeviceDrivers', 'EnumDeviceDrivers', 'EnumDirTree', 'EnumDisplayDevices', 'EnumDisplayMonitors',
                'EnumerateLoadedModules', 'EnumerateLoadedModules64', 'EnumerateLoadedModulesEx', 'EnumerateLoadedModulesW64',
                'EnumerateLoadedModulesW64', 'EnumerateSecurityPackages', 'EnumPageFiles', 'EnumPorts', 'EnumProcesses',
                'EnumProcesses', 'EnumProcessModules', 'EnumProcessModules', 'EnumProcessModulesEx', 'EnumPwrSchemes',
                'EnumResourceLanguages', 'EnumResourceNames', 'EnumResourceTypes', 'EnumServicesStatus', 'EnumServicesStatusEx', 'EnumSystemFirmwareTables',
                'EnumThreadWindows', 'EnumThreadWindows', 'EnumWindows', 'EnumWindowStations', 'EqualDomainSid',
                'EqualPrefixSid', 'EqualSid', 'EraseTape', 'EraseTape', 'errno', 'EtwEventEnabled', 'EtwEventRegister',
                'EtwEventUnregister', 'EtwEventWrite', 'EtwGetTraceEnableFlags', 'EtwGetTraceEnableLevel',
                'EtwGetTraceLoggerHandle', 'EtwRegisterTraceGuids', 'EtwTraceMessage', 'EtwUnregisterTraceGuids', 'ExecWB',
                'ExitProcess', 'ExitThread', 'ExitVDM', 'ExitWindowsEx', 'ExpandEnvironmentStringsForUser',
                'ExportSecurityContext', 'ExpungeConsoleCommandHistory',
                
                'FatalAppExit', 'FatalExit', 'FCIAddFile', 'FCICreate', 'FCIDestroy', 'FCIFlushCabinet', 'FCIFlushFolder',
                'FDICopy', 'FDICreate', 'FDIDestroy', 'FileRecycle', 'FillConsoleOutputCharacter', 'FindActCtxSectionString',
                'FindAtom', 'FindClose', 'FindCloseChangeNotification', 'FindCloseUrlCache', 'FindDebugInfoFile',
                'FindDebugInfoFileEx', 'FindExecutable', 'FindExecutable', 'FindExecutableImage', 'FindExecutableImageEx',
                'FindFileInPath', 'FindFileInSearchPath', 'FindFirstChangeNotification', 'FindFirstFile', 'FindFirstFileEx',
                'FindFirstFileName', 'FindFirstFileNameTransacted', 'FindFirstFileTransacted', 'FindFirstFreeAce',
                'FindFirstStream', 'FindFirstUrlCacheEntry', 'FindFirstVolume', 'FindFirstVolumeMountPoint',
                'FindNextChangeNotification', 'FindNextFile', 'FindNextFileName', 'FindNextStream', 'FindNextUrlCacheEntry',
                'FindNextVolume', 'FindNextVolumeMountPoint', 'FindResource', 'FindResourceEx', 'FindVolumeClose',
                'FindVolumeMountPointClose', 'FindWindow', 'FindWindowEx', 'FlushFileBuffers', 'FlushInstructionCache',
                'FlushIpNetTable', 'FlushProcessWriteBuffers', 'FlushTrace', 'FlushViewOfFile', 'ForceSyncFgPolicy',
                'formgrabber', 'freeaddrinfo', 'FreeConsole', 'FreeContextBuffer', 'FreeCredentialsHandle',
                'FreeCryptProvFromCert', 'FreeCryptProvFromCertEx', 'FreeDDElParam', 'FreeEnvironmentStrings', 'FreeGPOList',
                'FreeInheritedFromArray', 'FreeLibrary', 'FreeLibraryAndExitThread', 'FreeLibraryWhenCallbackReturns',
                'FreeResource', 'FreeSid', 'FreeUserPhysicalPages', 'FrostCrashedWindow', 'FtpCommand', 'FtpCreateDirectory',
                'FtpDeleteFile', 'FtpFindFirstFile', 'FtpGetCurrentDirectory', 'FtpGetFile', 'FtpGetFileSize', 'FtpOpenFile',
                'FtpPutFile', 'FtpRemoveDirectory', 'FtpRenameFile', 'FtpSetCurrentDirectory', 'FveEnableRawAccess', 'fwrite',
                
                'GenerateConsoleCtrlEvent', 'GetAcceptExSockaddrs', 'GetAccessSecurityDescriptor', 'GetAce',
                'GetAclInformation', 'GetActivePwrScheme', 'GetAdapterIndex', 'GetAdaptersAddresses', 'GetAdaptersInfo',
                'getaddrinfo', 'GetAllUsersProfileDirectory', 'GetAncestor', 'GetAppCompatFlags', 'GetAppCompatFlags2',
                'GetAppContainerNamedObjectPath', 'GetAppliedGPOList', 'GetAppPathFromLink', 'GetAsyncKeyState',
                'GetAtomName', 'GetAuditedPermissionsFromAcl', 'GetAuditedPermissionsFromAcl', 'GetAuditedPermissionsFromAcl',
                'GetBestRoute', 'GetBinaryType', 'GetCalendarInfo', 'GetCapture', 'GetChildTipbar', 'GetClassLong',
                'GetClipboardData', 'GetClipboardFormatName', 'GetClipboardOwner', 'GetClipboardSequenceNumber',
                'GetClipboardViewer', 'GetCommandLine', 'GetCompressedFileSize', 'GetComputerName', 'GetComputerNameEx',
                'GetConfigurationSecurityDescriptor', 'GetConsoleAlias', 'GetConsoleAliases', 'GetConsoleAliasesLength',
                'GetConsoleAliasExes', 'GetConsoleAliasExesLength', 'GetConsoleCommandHistory',
                'GetConsoleCommandHistoryLength', 'GetConsoleDisplayMode', 'GetConsoleFontInfo', 'GetConsoleFontSize',
                'GetConsoleHardwareState', 'GetConsoleInputExeName', 'GetConsoleInputWaitHandle',
                'GetConsoleKeyboardLayoutName', 'GetConsoleScreenBufferInfo', 'GetConsoleTitle', 'GetConsoleWindow',
                'GetCryptProvFromCert', 'GetCryptProvFromCertEx', 'GetCurrentConsoleFont', 'GetCurrentHwProfile',
                'GetCurrentPackageId', 'GetCurrentPowerPolicies', 'GetCurrentProcess', 'GetCurrentProcessId',
                'GetCurrentProcessorNumber', 'GetCurrentProcessorNumberEx', 'GetCurrentThread', 'GetCurrentThreadId',
                'GetDesktopWindow', 'GetDeviceDriverBaseName', 'GetDeviceDriverBaseName', 'GetDeviceDriverBaseName',
                'GetDeviceDriverFileName', 'GetDevicePowerState', 'GetDiskFreeSpace', 'GetDiskFreeSpaceEx',
                'GetDoubleClickTime', 'GetDriveType', 'GetEffectiveRightsFromAcl', 'getenv', 'GetEnvironmentStrings',
                'GetEnvironmentVariable', 'GetEventLogInformation', 'GetExitCodeProcess', 'GetExitCodeThread',
                'GetExpandedName', 'GetExplicitEntriesFromAcl', 'GetExtendedTcpTable', 'GetExtendedUdpTable',
                'GetFileAttributes', 'GetFileInformationByHandle', 'GetFileInformationByHandleEx', 'GetFileSecurity',
                'GetFileType', 'GetFileVersionInfo', 'GetFileVersionInfoSize', 'GetFirmwareEnvironmentVariable',
                'GetForegroundWindow', 'GetGeoInfo', 'GetGuiResources', 'GetGUIThreadInfo', 'gethostbyaddr', 'gethostbyname',
                'gethostbyname', 'gethostbyvalue', 'gethostname', 'gethostname', 'gethostvalue', 'GetIcmpStatistics',
                'GetIfEntry', 'GetIfTable', 'GetImageConfigInformation', 'GetImageUnusedHeaderBytes', 'GetInheritanceSource',
                'GetInputState', 'GetInternalWindowPos', 'GetIpAddrTable', 'GetIpNetTable', 'GetIpStatistics',
                'GetKernelObjectSecurity', 'GetKeyboardState', 'GetKeyState', 'GetLargestConsoleWindowSize',
                'GetLastActivePopup', 'GetLengthSid', 'GetLocaleInfo', 'GetLogicalDrives', 'GetLogicalDriveStrings',
                'GetLogicalProcessorInformation', 'GetLogicalProcessorInformationEx', 'GetMailslotInfo', 'GetMappedFileName',
                'GetMappedFileName', 'GetMessageExtraInfo', 'GetMessagePos', 'GetMessageTime', 'GetModuleBaseName',
                'GetModuleBaseName', 'GetModuleFileName', 'GetModuleFilename', 'GetModuleFileNameEx', 'GetModuleHandle',
                'GetModuleHandleEx', 'GetModuleInformation', 'GetModuleInformation', 'GetMonitorInfo', 'GetMultipleTrustee',
                'GetMultipleTrusteeOperation', 'GetNamedPipeInfo', 'GetNamedSecurityInfo', 'getnameinfo', 'GetNativeSystemInfo',
                'GetNetResourceFromLocalPath', 'GetNetworkParams', 'GetNumberOfConsoleFonts', 'GetNumberOfEventLogRecords',
                'GetNumberOfEventLogRecords', 'GetODBCSharedData', 'GetOEMCP', 'GetOldestEventLogRecord',
                'GetOldestEventLogRecord', 'GetOpenCardNameA', 'GetOpenCardNameW', 'GetOpenClipboardWindow',
                'GetOverlappedResult', 'getpeername', 'getpeername', 'getpeervalue', 'GetPerformanceInfo',
                'GetPhysicallyInstalledSystemMemory', 'GetPopupTipbar', 'GetPrinterDriverDirectory',
                'GetPrintProcessorDirectory', 'GetPriorityClipboardFormat', 'GetPrivateObjectSecurity', 'GetPrivateProfileInt',
                'GetPrivateProfileSection', 'GetPrivateProfileSectionNames', 'GetPrivateProfileString',
                'GetPrivateProfileStruct', 'GetProcAddress', 'GetProcessAffinityMask', 'GetProcessDEPPolicy', 'GetProcessHeap',
                'GetProcessId', 'GetProcessImageFileName', 'GetProcessIoCounters', 'GetProcessMemoryInfo',
                'GetProcessMemoryInfo', 'GetProcessMitigationPolicy', 'GetProcessTimes', 'GetProcessVersion',
                'GetProcessWindowStation', 'GetProcessWorkingSetSize', 'GetProductInfo', 'GetProfileInt',
                'GetProfilesDirectory', 'GetProfileSection', 'GetProfileString', 'GetProgmanWindow', 'getprotobyvalue',
                'GetPwrCapabilities', 'GetPwrDiskSpindownRange', 'GetQueueStatus', 'GetQueueStatus',
                'GetReasonTitleFromReasonCode', 'GetRegisteredRawInputDevices', 'GetSecurityDescriptorControl',
                'GetSecurityDescriptorDacl', 'GetSecurityDescriptorGroup', 'GetSecurityDescriptorLength',
                'GetSecurityDescriptorOwner', 'GetSecurityDescriptorRMControl', 'GetSecurityDescriptorSacl', 'GetSecurityInfo',
                'GetSendMessageReceiver', 'getservbyname', 'getservbyport', 'getservbyvalue', 'GetShellWindow',
                'GetSidIdentifierAuthority', 'GetSidLengthRequired', 'GetSidSubAuthority', 'GetSidSubAuthorityCount',
                'getsockname', 'getsockname', 'getsockopt', 'getsockopt', 'getsockvalue', 'GetSqmableFileName',
                'GetStartupInfo', 'GetStringType', 'GetSystemDefaultLangId', 'GetSystemDEPPolicy', 'GetSystemDirectory',
                'GetSystemFirmwareTable', 'GetSystemInfo', 'GetSystemPowerStatus', 'GetSystemWow64Directory',
                'GetTapeParameters', 'GetTapePosition', 'GetTapeStatus', 'GetTapeStatus', 'GetTaskmanWindow',
                'GetTcpStatistics', 'GetTcpStatisticsEx', 'GetTcpTable', 'GetTempFileName', 'GetTempPath', 'GetThreadContext',
                'GetThreadDesktop', 'GetThreadLocale', 'GetThreadTimes', 'GetTickCount', 'GetTimestampForLoadedLibrary',
                'GetTimeZoneInformation', 'GetTokenInformation', 'GetTraceEnableLevel', 'GetTrusteeForm', 'GetTrusteeName',
                'GetTrusteeType', 'GetTypeByName', 'GetUdpTable', 'GetUpdatedClipboardFormats', 'GetUrlCacheEntryInfo',
                'GetUrlCacheEntryInfoEx', 'GetUserGeoID', 'GetUserName', 'GetUserNameEx', 'GetUserObjectInformation',
                'GetUserObjectSecurity', 'GetUserProfileDirectory', 'GetVersion', 'GetVersionEx', 'GetVolumeInformation',
                'GetVolumeNameForVolumeMountPoint', 'GetVolumePathName', 'GetVolumePathNamesForVolumeName',
                'GetWindowCompositionAttribute', 'GetWindowModuleFileName', 'GetWindowsAccountDomainSid', 'GetWindowsDirectory',
                'GetWindowThreadProcessId', 'GetWriteWatch', 'GetWsChanges', 'GetWsChangesEx', 'GhostWindowFromHungWindow',
                'GlobalAddAtom', 'GlobalAlloc', 'GlobalDeleteAtom', 'GlobalFindAtom', 'GlobalFix', 'GlobalFlags', 'GlobalFree',
                'GlobalGetAtomName', 'GlobalHandle', 'GlobalLock', 'GlobalMemoryStatus', 'GlobalMemoryStatusEx',
                'GlobalReAlloc', 'GlobalUnfix', 'GlobalUnlock', 'GlobalUnWire', 'GUICtrlSendMsg', 'GUICtrlSendToDummy',
                'GUICtrlSetBkColor', 'GUICtrlSetColor', 'GUICtrlSetCursor', 'GUICtrlSetData', 'GUIDFormatToGlobalPowerPolicy',
                'GUIDFormatToPowerPolicy',
                
                'Heap32ListFirst', 'Heap32ListNext', 'HeapCreate', 'HeapQueryInformation', 'HeapSetInformation', 'HeapSummary',
                'HeapWalk', 'htonl', 'htons', 'htons', 'HttpAddRequestHeaders', 'HttpEndRequest', 'httpinjects',
                'HttpOpenRequest', 'HttpQueryInfo', 'HttpSendRequest', 'HttpSendRequestEx', 'httpshots',
                'HungWindowFromGhostWindow',
                
                'I_CryptUninstallAsn1Module', 'I_CryptUninstallOssGlobal', 'I_NetLogonControl', 'I_NetLogonControl2',
                'I_RpcMapWin32Status', 'Icmp6CreateFile', 'Icmp6ParseReplies', 'Icmp6SendEcho2', 'IcmpCloseHandle',
                'IcmpCloseHandle', 'IcmpCreateFile', 'IcmpCreateFile', 'IcmpParseReplies', 'IcmpParseReplies', 'IcmpSendEcho',
                'IcmpSendEcho', 'IcmpSendEcho', 'IcmpSendEcho2', 'IcmpSendEcho2', 'IcmpSendEcho2', 'IcmpSendEcho2Ex',
                'ImageAddCertificate', 'ImageDirectoryEntryToData', 'ImageDirectoryEntryToData', 'ImageDirectoryEntryToDataEx',
                'ImageEnumerateCertificates', 'ImageGetCertificateData', 'ImageGetCertificateHeader', 'ImageGetDigestStream',
                'ImagehlpApiVersion', 'ImagehlpApiVersionEx', 'ImageLoad', 'ImageNtHeader', 'ImageNtHeader',
                'ImageRemoveCertificate', 'ImageRvaToSection', 'ImageRvaToVa', 'ImageUnload', 'ImmGetContext',
                'ImpersonateAnonymousToken', 'ImpersonateLoggedOnUser', 'ImpersonateNamedPipeClient',
                'ImpersonateSecurityContext', 'ImpersonateSelf', 'ImportSecurityContextA', 'inet_addr', 'inet_addr',
                'inet_ntoa', 'inet_ntoa', 'InitAtomTable', 'InitCommonControls', 'InitializeAcl', 'InitializeChangeNotify',
                'InitializeProcessForWsWatch', 'InitializeSecurityContext', 'InitializeSecurityDescriptor', 'InitializeSid',
                'InitiateSystemShutdown', 'InitiateSystemShutdownEx', 'InitSecurityInterfaceA', 'Inject32End', 'Inject32Normal',
                'Inject32Start', 'InjectApcRoutine', 'InjectNormRoutine', 'InSendMessage', 'InSendMessageEx', 'Int64ToString',
                'InterlockedPushEntrySList', 'InternalGetUdpTable', 'InternalSetIpForwardEntry', 'InternalSetIpStats',
                'InternetAutodial', 'InternetAutodialHangup', 'InternetCanonicalizeUrl', 'InternetCheckConnection',
                'InternetCloseHandle', 'InternetCloseHandle', 'InternetCombineUrl', 'InternetConnect', 'InternetConnect',
                'InternetCrackUrl', 'InternetCrackUrl', 'InternetErrorDlg', 'InternetFindNextFile', 'InternetGetConnectedState',
                'InternetGetConnectedStateEx', 'InternetGetCookie', 'InternetGetCookieEx', 'InternetGetLastResponseInfo',
                'InternetOpen', 'InternetOpen', 'InternetOpen', 'InternetOpenUrl', 'InternetOpenUrl',
                'InternetQueryDataAvailable', 'InternetQueryDataAvailable', 'InternetQueryOption', 'InternetQueryOption',
                'InternetReadFile', 'InternetReadFileEx', 'InternetSecurityProtocolToString', 'InternetSetCookie',
                'InternetSetOption', 'InternetSetOption', 'InternetSetStatusCallback', 'InternetWriteFile',
                'InternetWriteFile', 'InvalidateConsoleDIBits', 'IoCreateDevice', 'IoCreateFile', 'ioctlsocket',
                'ioctlsocket', 'IoDeleteDevice', 'IoGetCurrentProcess', 'IoRegisterBootDriverReinitialization',
                'IsAdminOverrideActive', 'IsBadReadPtr', 'IsBadStringPtr', 'IsClipboardFormatAvailable', 'IsDebuggerPresent',
                'IsElevationRequired', 'IsLoggingEnabled', 'IsNativeVhdBoot', 'IsNetworkAlive', 'IsNTAdmin',
                'IsProcessorFeaturePresent', 'IsPwrHibernateAllowed', 'IsPwrShutdownAllowed', 'IsPwrSuspendAllowed',
                'IsSearchEnabled', 'IsServerSideWindow', 'IsSETEnabled', 'IsSystemResumeAutomatic', 'IsThreadDesktopComposited',
                'IsTokenRestricted', 'IStream_ReadStrLong', 'IStream_WriteStrLong', 'IsValidAcl', 'IsValidLanguageGroup',
                'IsValidSecurityDescriptor', 'IsValidSid', 'IsValidURL', 'IsWellKnownSid', 'IsWindowInDestroy',
                'IsWindowVisible', 'IsWoW64Process', 'IUnknown_RemoveBackReferences', 'IUnknown_TranslateAcceleratorGlobal',
                'IUnknown_TranslateAcceleratorIO',
                
                'JournalPlaybackProc',
                
                'K32EnumProcesses', 'K32EnumProcessModules', 'K32GetModuleBaseName', 'K32GetModuleFileNameEx',
                'K32GetProcessImageFileName', 'KeAddSystemServiceTable', 'KeBugCheckEx', 'KeServiceDescriptorTable',
                'keybd_event', 'KillSystemTimer',
                
                'LargeIntegerToString', 'LCMapString', 'LdrAccessResource', 'LdrAddLoadAsDataTable', 'LdrAddRefDll',
                'LdrDisableThreadCalloutsForDll', 'LdrEnumerateLoadedModules', 'LdrEnumResources', 'LdrFindEntryForAddress',
                'LdrFindResource_U', 'LdrFindResourceDirectory_U', 'LdrFindResourceEx_U', 'LdrFlushAlternateResourceModules',
                'LdrGetDllHandle', 'LdrGetDllHandleByMapping', 'LdrGetDllHandleByName', 'LdrGetDllHandleEx',
                'LdrGetFailureData', 'LdrGetFileNameFromLoadAsDataTable', 'LdrGetProcedureAddress', 'LdrGetProcedureAddressEx',
                'LdrHotPatchRoutine', 'LdrInitializeThunk', 'LdrInitShimEngineDynamic', 'LdrLoadAlternateResourceModule',
                'LdrLoadAlternateResourceModuleEx', 'LdrLoadDll', 'LdrLockLoaderLock', 'LdrOpenImageFileOptionsKey',
                'LdrpResGetMappingSize', 'LdrpResGetResourceDirectory', 'LdrProcessRelocationBlock',
                'LdrQueryImageFileExecutionOptions', 'LdrQueryImageFileExecutionOptionsEx', 'LdrQueryImageFileKeyOption',
                'LdrQueryModuleServiceTags', 'LdrQueryProcessModuleInformation', 'LdrRegisterDllNotification',
                'LdrRemoveLoadAsDataTable', 'LdrResFindResource', 'LdrResFindResourceDirectory', 'LdrResGetRCConfig',
                'LdrResRelease', 'LdrResSearchResource', 'LdrRscIsTypeExist', 'LdrSetAppCompatDllRedirectionCallback',
                'LdrSetDllManifestProber', 'LdrSetMUICacheType', 'LdrShutdownProcess', 'LdrShutdownThread',
                'LdrSystemDllInitBlock', 'LdrUnloadAlternateResourceModule', 'LdrUnloadAlternateResourceModuleEx',
                'LdrUnloadDll', 'LdrUnlockLoaderLock', 'LdrUnregisterDllNotification', 'LdrVerifyImageMatchesChecksum',
                'LdrVerifyImageMatchesChecksumEx', 'LdrWx86FormatVirtualImage', 'LinkWindow_RegisterClass', 'listen', 'listen',
                'LoadCurrentPwrScheme', 'LoadLibrary', 'LoadLibraryEx', 'LoadModule', 'LoadResource', 'LoadStringByReference',
                'LoadUserProfile', 'LocalAlloc', 'LocalCompact', 'LocalFlags', 'LocalFree', 'LocalReAlloc', 'LockFile',
                'LockFileEx', 'LockResource', 'LockServiceDatabase', 'LockSetForegroundWindow', 'LockWindowStation',
                'LockWorkStation', 'LockWorkStation', 'LogonUser', 'longjmp', 'LookupAccountName', 'LookupAccountSid',
                'LookupPrivilegeDisplayName', 'LookupPrivilegeName', 'LookupPrivilegeValue', 'LookupPrivilegeValue',
                'LookupSecurityDescriptorParts', 'LsaAddAccountRights', 'LsaCallAuthenticationPackage', 'LsaClose',
                'LsaConnectUntrusted', 'LsaDeregisterLogonProcess', 'LsaEnumerateAccountRights', 'LsaEnumerateLogonSessions',
                'LsaFreeMemory', 'LsaGetLogonSessionData', 'LsaLookupAuthenticationPackage', 'LsaOpenPolicy', 'LsaSetSecret',
                'LsaUnregisterPolicyChangeNotification', 'LZClose', 'LZCopy', 'LZCopy', 'LZCreateFile', 'LZCreateFile',
                'LZDone', 'LZInit', 'LZInit', 'LZOpenFile', 'LZOpenFile', 'LZSeek', 'LZSeek', 'LZStart', 'LZStart',
                
                'MakeAbsoluteSD', 'MakeSelfRelativeSD', 'MakeSignature', 'MakeSureDirectoryPathExists', 'MapAndLoad',
                'MapDebugInformation', 'MapFileAndCheckSum', 'MapGenericMask', 'MAPILogonEx', 'MapUserPhysicalPagesScatter',
                'MapViewOfFile', 'MapViewOfFileEx', 'MapVirtualKey', 'MapWin32ErrorToSTG', 'MB_GetString', 'MBToWCSEx',
                'McastApiCleanup', 'McastApiStartup', 'McastEnumerateScopes', 'McastGenUID', 'McastReleaseAddress',
                'McastRenewAddress', 'McastRequestAddress', 'MD5Final', 'MD5Init', 'MD5Update', 'memset',
                'MergeLegacyPwrScheme', 'MethCallEngine', 'MigrateWinsockConfiguration', 'MiniDumpWriteDump',
                'MmGetSystemRoutineAddress', 'ModeToCreateFileFlags', 'Module32First', 'Module32Next', 'MonitorEnumProc',
                'MonitorFromPoint', 'MonitorFromRect', 'MonitorFromWindow', 'mouse_event', 'MoveFile', 'MoveFileEx',
                'MoveFileTransacted', 'MoveFileWithProgress', 'MprAdminUserClose', 'MprAdminUserGetInfo', 'MprAdminUserOpen',
                'MprAdminUserRead', 'MprAdminUserUserClose', 'MprAdminUserUserOpen', 'MprAdminUserWrite', 'MsiRecordReadStream',
                'MsiSummaryInfoPersist', 'MultinetGetConnectionPerformance',
                
                'Navigate', 'Navigate2', 'NdrAsyncClientCall', 'NdrClearOutParameters', 'NdrClientCall', 'NdrClientCall2',
                'NdrConformantArrayUnmarshall', 'NdrConformantStringBufferSize', 'NdrConformantStringMarshall',
                'NdrConformantStringUnmarshall', 'NdrContextHandleInitialize', 'NdrContextHandleMemorySize',
                'NdrContextHandleSize', 'NdrConvert', 'NdrCStdStubBuffer_Release', 'NdrCStdStubBuffer2_Release',
                'NdrDllCanUnloadNow', 'NdrDllGetClassObject', 'NdrDllRegisterProxy', 'NdrDllUnregisterProxy',
                'NdrGetUserMarshalInfo', 'NdrInterfacePointerBufferSize', 'NdrInterfacePointerFree',
                'NdrInterfacePointerMarshall', 'NdrInterfacePointerUnmarshall', 'NdrOleAllocate', 'NdrOleFree',
                'NdrPointerBufferSize', 'NdrPointerFree', 'NdrPointerMarshall', 'NdrPointerUnmarshall', 'NdrProxyErrorHandler',
                'NdrProxyFreeBuffer', 'NdrProxyGetBuffer', 'NdrProxyInitialize', 'NdrProxySendReceive', 'NdrSimpleTypeMarshall',
                'NdrSimpleTypeUnmarshall', 'NdrStubCall2', 'NdrStubForwardingFunction', 'NdrStubGetBuffer', 'NdrStubInitialize',
                'NdrUserMarshalBufferSize', 'NdrUserMarshalFree', 'NdrUserMarshalMarshall', 'NetAccessAdd', 'NetAccessDel',
                'NetAccessEnum', 'NetAccessGetInfo', 'NetAccessGetUserPerms', 'NetAccessSetInfo', 'NetAuditClear',
                'NetAuditRead', 'Netbios', 'NetBrowserStatisticsGet', 'NetConfigSet', 'NetConnectionEnum',
                'NetEnumerateTrustedDomains', 'NetErrorLogClear', 'NetErrorLogRead', 'NetErrorLogWrite', 'NetFileClose"',
                'NetFileGetInfo', 'NetGetAnyDCName', 'NetGetDCName', 'NetGetDisplayInformationIndex', 'NetGetJoinInformation',
                'NetGroupAdd', 'NetGroupAddUser', 'NetGroupDel', 'NetGroupDelUser', 'NetGroupEnum', 'NetGroupGetInfo',
                'NetGroupGetUsers', 'NetGroupSetInfo', 'NetGroupSetUsers', 'NetLocalGroupAdd', 'NetLocalGroupAddMember',
                'NetLocalGroupAddMembers', 'NetLocalGroupDel', 'NetLocalGroupDelMember', 'NetLocalGroupDelMembers',
                'NetLocalGroupEnum', 'NetLocalGroupGetInfo', 'NetLocalGroupGetMembers', 'NetLocalGroupSetInfo',
                'NetLocalGroupSetMembers', 'NetpwNameValidate', 'NetQueryDisplayInformation', 'NetRemoteTOD',
                'NetScheduleJobAdd', 'NetServerEnum', 'NetServerGetInfo', 'NetServiceEnum', 'NetSessionEnum', 'NetShareAdd',
                'NetShareDel', 'NetShareEnum', 'NetShareGetInfo', 'NetStatisticsGet', 'NetUserAdd', 'NetUserChangePassword',
                'NetUserDel', 'NetUserEnum', 'NetUserGetGroups', 'NetUserGetInfo', 'NetUserGetLocalGroups', 'NetUserModalsGet',
                'NetUserModalsSet', 'NetUserSetGroups', 'NetUserSetInfo', 'NetValidatePasswordPolicy',
                'NetValidatePasswordPolicyFree', 'NetWkstaGetInfo', 'NetWkstaTransportEnum', 'NetWkstaUserEnum',
                'NetWkstaUserGetInfo', 'NhGetGuidFromInterfaceName', 'NhpAllocateAndGetInterfaceInfoFromStack',
                'NlsGetCacheUpdateCount', 'NotifyChangeEventLog', 'NotifyChangeEventLog', 'NotifyWinEvent', 'NPLoadNameSpaces',
                'NtAccessCheckByTypeResultListAndAuditAlarm', 'NtAddAtom', 'NtAdjustPrivilegesToken', 'NtClose',
                'NtCompareTokens', 'NtContinue', 'NtCreateFile', 'NtCreateProcess', 'NtCreateProcessEx', 'NtCreateSection',
                'NtCreateThread', 'NtCreateUserProcess', 'NtDelayExecution', 'NtDeleteFile', 'NtDeleteKey',
                'NtDeviceIoControlFile', 'NtEnumerateKey', 'NtEnumerateValueKey', 'NtFsControlFile',
                'NtImpersonateAnonymousToken', 'NtLoadDriver', 'NtLoadKey', 'NtMapViewOfSection', 'ntohl', 'ntohs', 'ntohs',
                'NtOpenEvent', 'NtOpenFile', 'NtOpenKey', 'NtOpenProcess', 'NtOpenProcessToken', 'NtOpenSection',
                'NtOpenSymbolicLinkObject', 'NtOpenThreadToken', 'NtProtectVirtualMemory', 'NtQueryDirectoryFile',
                'NtQueryInformationFile', 'NtQueryInformationProcess', 'NtQueryInformationThread', 'NtQueryKey',
                'NtQueryObject', 'NtQuerySymbolicLinkObject', 'NtQuerySystemInformation', 'NtQueryVirtualMemory',
                'NtResumeProcess', 'NtResumeThread', 'NtSetContextThread', 'NtSetEvent', 'NtSetInformationFile',
                'NtSetInformationProcess', 'NtSetInformationThread', 'NtSetSecurityObject', 'NtSuspendProcess',
                'NtTerminateProcess', 'NtUnloadDriver', 'NtUnloadKey', 'NtUnmapViewOfSection', 'NtUserSetChildWindowNoActivate',
                'NtWaitForSingleObject', 'NtWow64CallFunction64', 'NtWow64CsrAllocateCaptureBuffer',
                'NtWow64CsrAllocateMessagePointer', 'NtWow64CsrCaptureMessageBuffer', 'NtWow64CsrCaptureMessageString',
                'NtWow64CsrClientCallServer', 'NtWow64CsrClientConnectToServer', 'NtWow64CsrFreeCaptureBuffer',
                'NtWow64CsrGetProcessId', 'NtWow64CsrIdentifyAlertableThread', 'NtWow64CsrVerifyRegion', 'NtWow64DebuggerCall',
                'NtWow64GetCurrentProcessorNumberEx', 'NtWow64GetNativeSystemInformation', 'NtWow64InterlockedPopEntrySList',
                'NtWow64QueryInformationProcess64', 'NtWow64QueryVirtualMemory64', 'NtWow64ReadVirtualMemory64',
                'NtWow64WriteVirtualMemory64', 'NtWriteFile', 'NtWriteVirtualMemory',
                
                'ObjectCloseAuditAlarm', 'ObjectDeleteAuditAlarm', 'ObjectOpenAuditAlarm', 'ObjectPrivilegeAuditAlarm',
                'ObtainUserAgentString', 'ODBCInternalConnectW', 'ODBCQualifyFileDSNW', 'OemKeyScan', 'OleFlushClipboard',
                'OleGetClipboard', 'OleInitialize', 'OleInitialize', 'OleRegEnumFormatEtc', 'OleRun', 'OleSetClipboard',
                'OleUninitialize', 'OneXAddEapAttributes', 'OneXAddTLV', 'OneXCompareAuthParams', 'OneXCopyAuthParams',
                'OneXCreateDefaultProfile', 'OneXCreateDiscoveryProfiles', 'OneXCreateSupplicantPort', 'OneXDeInitialize',
                'OpenBackupEventLog', 'OpenClipboard', 'OpenConsole', 'OpenDesktop', 'OpenEncryptedFileRaw', 'OpenEvent',
                'OpenEventLog', 'OpenFile', 'OpenFileMapping', 'OpenInputDesktop', 'OpenMutex', 'OpenODBCPerfData',
                'OpenProcess', 'OpenProcessToken', 'OpenProfileUserMapping', 'OpenSCManager', 'OpenSemaphore', 'OpenService',
                'OpenThread', 'OpenThreadToken', 'OpenTrace', 'OpenWindowStation', 'OpenWindowStation', 'OutputDebugString',
                
                'PackDDElParam', 'PathCombine', 'PathFindExtension', 'PathFindFileName', 'PathGetDriveNumber',
                'PathGetPathDisplayName', 'PathIsDirectory', 'PathIsDirectoryEmpty', 'PathIsTemporary', 'PathIsURL',
                'PathRemoveFileSpec', 'PathRenameExtension', 'PathUnExpandEnvStringsForUserW', 'PathUnExpandSystemEnvStringsW',
                'PDBOpenValidate5', 'PdhAddCounter', 'PdhCloseQuery', 'PdhCollectQueryData', 'PdhGetFormattedCounterValue',
                'PdhOpenQuery', 'PeekConsoleInput', 'PeekMessage', 'PeekNamedPipe', 'PFXExportCertStore',
                'PFXExportCertStoreEx', 'PFXImportCertStore', 'PortCompressionSetInfo', 'PostMessage', 'PostQuitMessage',
                'PostThreadMessage', 'PowerApplyPowerRequestOverride', 'PowerCanRestoreIndividualDefaultPowerScheme',
                'PowerCreatePossibleSetting', 'PowerCreateSetting', 'PowerCustomizePlatformPowerSettings',
                'PowerDebugDifPowerPolicies', 'PowerDebugDifSystemPowerPolicies', 'PowerDebugDumpPowerPolicy',
                'PowerDebugDumpPowerScheme', 'PowerDebugDumpSystemPowerCapabilities', 'PowerDebugDumpSystemPowerPolicy',
                'PowerDeleteScheme', 'PowerDeterminePlatformRole', 'PowerDuplicateScheme', 'PowerEnumerate',
                'PowerGetActiveScheme', 'PowerImportPowerScheme', 'PowerOpenSystemPowerKey', 'PowerOpenUserPowerKey',
                'PowerPolicyToGUIDFormat', 'PowerReadACDefaultIndex', 'PowerReadACValue', 'PowerReadACValueIndex',
                'PowerReadDCDefaultIndex', 'PowerReadDCValue', 'PowerReadDCValueIndex', 'PowerReadDescription',
                'PowerReadFriendlyName', 'PowerReadIconResourceSpecifier', 'PowerReadPossibleDescription',
                'PowerReadPossibleFriendlyName', 'PowerReadPossibleValue', 'PowerReadSecurityDescriptor',
                'PowerReadSettingAttributes', 'PowerReadValueIncrement', 'PowerReadValueMax', 'PowerReadValueMin',
                'PowerReadValueUnitsSpecifier', 'PowerRemovePowerSetting', 'PowerReplaceDefaultPowerSchemes',
                'PowerRestoreDefaultPowerSchemes', 'PowerRestoreIndividualDefaultPowerScheme', 'PowerSetActiveScheme',
                'PowerSetAlsBrightnessOffset', 'PowerSettingAccessCheck', 'PowerSettingRegisterNotification',
                'PowerSettingUnregisterNotification', 'PowerWriteACDefaultIndex', 'PowerWriteACValueIndex',
                'PowerWriteDCDefaultIndex', 'PowerWriteDCValueIndex', 'PowerWriteDescription', 'PowerWriteFriendlyName',
                'PowerWriteIconResourceSpecifier', 'PowerWritePossibleDescription', 'PowerWritePossibleFriendlyName',
                'PowerWritePossibleValue', 'PowerWriteSecurityDescriptor', 'PowerWriteSettingAttributes',
                'PowerWriteValueIncrement', 'PowerWriteValueMax', 'PowerWriteValueMin', 'PowerWriteValueUnitsSpecifier',
                'PR_Close', 'PR_GetError', 'PR_Poll', 'PR_Read', 'PR_SetError', 'PR_Write', 'PrepareTape',
                'Printer_AddPrinterPropPages', 'Printer_LoadIcons', 'Printers_RegisterWindow', 'Printers_UnregisterWindow',
                'PrivilegeCheck', 'PrivilegedServiceAuditAlarm', 'ProcCallEngine', 'Process32First', 'Process32Next',
                'ProcessIdToSessionId', 'ProcessTrace', 'PsChargePoolQuota', 'PsCreateSystemThread',
                'PsDereferenceImpersonationToken', 'PsDereferencePrimaryToken', 'PsGetCurrentProcessId',
                'PsGetProcessExitTime', 'PsImpersonateClient', 'PsInitialSystemProcess', 'PsIsDiskCountersEnabled',
                'PsIsThreadTerminating', 'PsLookupProcessByProcessId', 'PsLookupProcessByProcessId',
                'PsLookupProcessThreadByCid', 'PsLookupThreadByThreadId', 'PsReferenceImpersonationToken',
                'PsReferencePrimaryToken', 'PsReturnPoolQuota', 'PsRevertToSelf', 'PsSetCreateProcessNotifyRoutine',
                'PsSetLoadImageNotifyRoutine', 'PsTerminateSystemThread', 'PStoreCreateInstance', 'PStoreEnumProviders',
                'PsUpdateDiskCounters', 'PvkFreeCryptProv', 'PvkGetCryptProv', 'PvkPrivateKeyAcquireContext',
                'PvkPrivateKeyAcquireContextFromMemory', 'PvkPrivateKeyLoad', 'PvkPrivateKeyLoadFromMemory',
                'PvkPrivateKeyReleaseContext', 'PvkPrivateKeySave', 'PvkPrivateKeySaveToMemory',
                
                'QueryAllTraces', 'QueryContextAttributes', 'QueryCredentialsAttributes', 'QueryDosDevice',
                'QueryFullProcessImageName', 'QueryPerformanceCounter', 'QueryPerformanceFrequency', 'QuerySecurityAccessMask',
                'QuerySecurityContextToken', 'QuerySecurityPackageInfo', 'QuerySendMessage', 'QueryServiceConfig',
                'QueryServiceConfig2', 'QueryServiceObjectSecurity', 'QueryServiceStatus', 'QueryServiceStatusEx',
                'QuerySourceCreateFromKey', 'QuerySourceCreateFromKeyEx', 'QueryWorkingSet', 'QueryWorkingSet',
                'QueryWorkingSetEx', 'QueueUserAPC', 'QueueUserAPC',
                
                'RaiseException', 'RasEnumEntries', 'RasGetConnectStatus', 'RasHangUp', 'ReadConsole', 'ReadConsoleInput',
                'ReadConsoleInputEx', 'ReadEncryptedFileRaw', 'ReadEventLog', 'ReadFileScatter', 'ReadGlobalPwrPolicy',
                'ReadProcessMemory', 'ReadProcessMemory', 'ReadProcessorPwrScheme', 'ReadPwrScheme', 'RealShellExecute',
                'RealShellExecuteEx', 'ReasonCodeNeedsBugID', 'ReBaseImage', 'ReBaseImage64', 'RecordShutdownReason', 'recv',
                'recv', 'recv', 'recvfrom', 'recvfrom', 'redirects', 'RefreshBrowserLayout', 'RefreshPolicy',
                'RegConnectRegistry', 'RegCopyTree', 'RegCreateKey', 'RegCreateKeyEx', 'RegDeleteKey', 'RegDeleteValue',
                'RegDeleteValueU', 'RegDisablePredefinedCache', 'RegDisablePredefinedCacheEx', 'RegDisableReflectionKey',
                'RegEnableReflectionKey', 'RegEnumKey', 'RegEnumKeyEx', 'RegFlushKey', 'RegGetKeySecurity', 'register_icmp',
                'register_icmp', 'RegisterClipboardFormat', 'RegisterClipboardFormat', 'RegisterDeviceNotification',
                'RegisterEventSource', 'RegisterEventSource', 'RegisterHotKey', 'RegisterRawInputDevices',
                'RegisterServiceCtrlHandler', 'RegisterShellHookWindow', 'RegisterShellHookWindow', 'RegisterSystemThread',
                'RegisterTasklist', 'RegisterUserApiHook', 'RegisterWindowMessage', 'RegisterWowBaseHandlers', 'RegLoadKey',
                'RegNotifyChangeKeyValue', 'RegOpenKey', 'RegReplaceKey', 'RegRestoreKey', 'RegSaveKey', 'RegSetKeySecurity',
                'RegSetValue', 'RegSetValueEx', 'RegUnLoadKey', 'ReleaseMutex', 'ReleaseSemaphore',
                'RemoveClipboardFormatListener', 'RemoveDirectory', 'RemovePrivateCvSymbolic', 'RemovePrivateCvSymbolicEx',
                'RemoveRelocations', 'RemoveVectoredExceptionHandler', 'ReplaceFile', 'ReplyMessage', 'ReportEvent',
                'ReportEvent', 'ResetEvent', 'ResolveDelayLoadedAPI', 'ResolveDelayLoadsFromDll', 'RestoreLastError',
                'ResumeSuspendedDownload', 'ResumeThread', 'RevertSecurityContext', 'RevertToSelf', 'RpcMgmtSetServerStackSize',
                'RpcMgmtStopServerListening', 'RpcMgmtWaitServerListen', 'RpcServerListen', 'RpcServerRegisterIf',
                'RpcServerTestCancel', 'RpcServerUnregisterIf', 'RpcServerUnregisterIfEx', 'RpcServerUseProtseqEp',
                'RpcStringFree', 'RsopResetPolicySettingStatus', 'RsopSetPolicySettingStatus', 'rtcKillFiles', 'rtcMakeDir',
                'rtcRandomNext', 'rtcSetFileAttr', 'rtcShell', 'RtlAcquireResourceExclusive', 'RtlAcquireResourceShared',
                'RtlAddFunctionTable', 'RtlAdjustPrivilege', 'RtlAllocateAndInitializeSid', 'RtlCaptureContext',
                'RtlCaptureStackBackTrace', 'RtlCompareMemory', 'RtlConvertSidToUnicodeString', 'RtlCreateRegistryKey',
                'RtlCreateSecurityDescriptor', 'RtlDelete', 'RtlDeleteResource', 'RtlDumpResource', 'RtlEnterCriticalSection',
                'RtlFormatCurrentUserKeyPath', 'RtlImageDirectoryEntryToData', 'RtlImageNtHeader', 'RtlInitializeResource',
                'RtlLeaveCriticalSection', 'RtlLockCurrentThread', 'RtlLookupFunctionEntry', 'RtlMoveMemory',
                'RtlQueryElevationFlags', 'RtlQueryRegistryValues', 'RtlReleaseResource', 'RtlSetDaclSecurityDescriptor',
                'RtlSetOwnerSecurityDescriptor', 'RtlSetProcessIsCritical', 'RtlTraceDatabaseAdd', 'RtlTraceDatabaseCreate',
                'RtlTraceDatabaseDestroy', 'RtlTraceDatabaseEnumerate', 'RtlTraceDatabaseFind', 'RtlTraceDatabaseLock',
                'RtlTraceDatabaseUnlock', 'RtlTraceDatabaseValidate', 'RtlUnlockCurrentThread', 'RtlUserThreadStart',
                'RtlVirtualUnwind', 'RtlWriteRegistryValue', 'RunAsNewUser_RunDLL',
                
                'SaferiIsExecutableFileType', 'SaferRecordEventLogEntry', 'SamIConnect', 'SamIGetPrivateData',
                'SamQueryInformationUse', 'SCardAccessStartedEvent', 'SCardBeginTransaction', 'SCardControl',
                'SCardDisconnect', 'SCardDlgExtendedError', 'SCardEndTransaction', 'SCardEstablishContext',
                'SCardListReaders', 'SCardReconnect', 'SCardReleaseContext', 'SCardReleaseStartedEvent', 'SCardStatus',
                'SCardTransmit', 'SCardUIDlgSelectCardA', 'SCardUIDlgSelectCardW', 'SceAddToNameList',
                'SceAddToNameStatusList', 'SceAddToObjectList', 'SceAnalyzeSystem', 'SceAppendSecurityProfileInfo',
                'SceBrowseDatabaseTable', 'SceCloseProfile', 'SceCommitTransaction', 'SceCompareNameList',
                'SceCompareSecurityDescriptors', 'SceConfigureConvertedFileSecurity,', 'SceConfigureSystem',
                'SceCopyBaseProfile', 'SceCreateDirectory', 'SceDcPromoCreateGPOsInSysvol', 'SceDcPromoCreateGPOsInSysvolEx',
                'SceDcPromoteSecurity', 'SceDcPromoteSecurityEx', 'SceEnforceSecurityPolicyPropagation',
                'SceEnumerateServices', 'SceFreeMemory', 'SceFreeProfileMemory', 'SceGenerateGroupPolicy',
                'SceGenerateRollback', 'SceGetAnalysisAreaSummary', 'SceGetAreas', 'SceGetDatabaseSetting',
                'SceGetDbTime', 'SceGetObjectChildren', 'SceGetObjectSecurity', 'SceGetScpProfileDescription',
                'SceGetSecurityProfileInfo', 'SceGetServerProductType', 'SceGetTimeStamp', 'SceIsSystemDatabase',
                'SceLookupPrivRightName', 'SceNotifyPolicyDelta', 'SceOpenPolicy', 'SceOpenProfile',
                'SceProcessSecurityPolicyGPO', 'SceProcessSecurityPolicyGPOEx', 'SceRegisterRegValues',
                'SceRollbackTransaction', 'SceSetDatabaseSetting', 'SceSetupBackupSecurity', 'SceSetupConfigureServices',
                'SceSetupGenerateTemplate', 'SceSetupMoveSecurityFile', 'SceSetupRootSecurity', 'SceSetupSystemByInfName',
                'SceSetupUnwindSecurityFile', 'SceSetupUpdateSecurityFile', 'SceSetupUpdateSecurityKey',
                'SceSetupUpdateSecurityService', 'SceStartTransaction', 'SceSvcConvertSDToText', 'SceSvcConvertTextToSD',
                'SceSvcFree', 'SceSvcGetInformationTemplate', 'SceSvcQueryInfo', 'SceSvcSetInfo',
                'SceSvcSetInformationTemplate', 'SceSvcUpdateInfo', 'SceSysPrep', 'SceUpdateObjectInfo',
                'SceUpdateSecurityProfile', 'SceWriteSecurityProfileInfo', 'ScriptBreak', 'ScriptFreeCache', 'ScriptItemize',
                'ScriptLayout', 'ScriptPlace', 'ScriptShape', 'ScriptStringAnalyse', 'ScriptStringOut', 'SealMessage',
                'SearchTreeForFile', 'select', 'select', 'SelectTransDlg', 'SelfDelete', 'send', 'send', 'Send', 'SendARP',
                'SendAsyncProc', 'SendAttachMode', 'SendCapslockMode', 'SendCommandID', 'SendIMEMessage', 'SendIMEMessageEx',
                'SendKeepActive', 'SendKeyDelay', 'SendKeyDownDelay', 'SendLogs', 'SendMessage', 'SendMessageCallback',
                'SendMessageTimeout', 'SendNotifyMessage', 'sendto', 'sendto', 'SeSetSecurityDescriptorInfo',
                'SetAccessSecurityDescriptor', 'SetAclInformation', 'SetActivePwrScheme', 'SetAdapterIpAddress',
                'SetClipboardData', 'SetClipboardViewer', 'SetClipboardViewer', 'SetComputerName', 'SetComputerNameEx',
                'SetConfigurationSecurityDescriptor', 'SetConsoleCtrlHandler', 'SetConsoleCursor', 'SetConsoleDisplayMode',
                'SetConsoleFont', 'SetConsoleHardwareState', 'SetConsoleIcon', 'SetConsoleInputExeName',
                'SetConsoleKeyShortcuts', 'SetConsoleMaximumWindowSize', 'SetConsoleMenuClose', 'SetConsoleMode',
                'SetConsoleNumberOfCommands', 'SetConsolePalette', 'SetCPGlobal', 'SetCurrentDirectory', 'SetDebugErrorLevel',
                'SetDefaultDllDirectories', 'SetDllDirectory', 'SetEntriesInAcl', 'SetEntriesInAcl', 'SetEnvironmentVariable',
                'SetErrorMode', 'SetEvent', 'SetFileAttributes', 'SetFileSecurity', 'SetFileTime',
                'SetFirmwareEnvironmentVariable', 'SetFirmwareEnvironmentVariableEx', 'SetForegroundWindow', 'SetHandleCount',
                'SetImageConfigInformation', 'SetIpForwardEntry', 'SetIpTTL', 'setjmp', 'SetKernelObjectSecurity',
                'SetKeyboardState', 'SetLastConsoleEventActive', 'SetLastError', 'SetLaunchSecurityDescriptor',
                'SetLocalPrimaryComputerName', 'SetMailslotInfo', 'SetMessageExtraInfo', 'SetNamedPipeHandleState',
                'SetNamedSecurityInfo', 'SetNamedSecurityInfo', 'SetPrivateObjectSecurity', 'SetPrivateObjectSecurityEx',
                'SetProcessAffinityMask', 'SetProcessDEPPolicy', 'SetProcessShutdownParameters', 'SetProcessWindowStation',
                'SetRegisterLangBand', 'SetSecurityAccessMask', 'SetSecurityDescriptorControl', 'SetSecurityDescriptorDacl',
                'SetSecurityDescriptorGroup', 'SetSecurityDescriptorOwner', 'SetSecurityDescriptorRMControl',
                'SetSecurityDescriptorSacl', 'SetSecurityInfo', 'SetService', 'SetServiceObjectSecurity', 'SetServiceStatus',
                'SetShellWindowEx', 'setsockopt', 'SetStdHandle', 'SetStdHandleEx', 'SetSuspendState', 'SetSystemPowerState',
                'SetSystemTimeAdjustment', 'SetTapeParameters', 'SetTapePosition', 'SetThreadContext', 'SetThreadDesktop',
                'SetThreadExecutionState', 'SetThreadLocale', 'SetThreadPriority', 'SetThreadStackGuarantee', 'SetThreadToken',
                'settings', 'SetTokenInformation', 'SetUnhandledExceptionFilter', 'SetupDiClassGuidsFromNameEx',
                'SetupDiDestroyDeviceInfoList', 'SetupDiEnumDeviceInfo', 'SetupDiEnumDeviceInterfaces', 'SetupDiGetClassDevs',
                'SetupDiGetDeviceInterfaceDetail', 'SetupDiGetDeviceRegistryProperty', 'SetupDiOpenDevRegKey',
                'SetUserObjectInformation', 'SetUserObjectSecurity', 'SetVDMCurrentDirectories', 'SetVolumeLabel',
                'SetVolumeMountPoint', 'SetWindowCompositionAttribute', 'SetWindowLong', 'SetWindowsHook', 'SetWindowsHookEx',
                'SetWindowsHookW', 'SetWindowStationUser', 'SetWinEventHook', 'SetWinEventHook', 'SFCDisable', 'SfcGetFiles',
                'SfcGetNextProtectedFile', 'SfcIsFileProtected', 'SfcIsKeyProtected', 'SFCScan', 'SfcTerminateWatcherThread',
                'SHAnsiToUnicodeCPAlloc', 'SHAreIconsEqual', 'SHBoolSystemParametersInfo', 'SHChangeNotify',
                'SHChangeNotifyDeregister', 'SHCopyKey', 'SHCreateDirectory', 'SHCreatePropertyBagOnMemory',
                'SHCreatePropertyStoreOnXML', 'SHCreateStreamOnDllResourceW', 'SHCreateStreamOnModuleResourceW',
                'SHDeleteEmptyKey', 'SHDeleteKey', 'SHDeleteValue', 'ShellExecCmdLine', 'ShellExecute', 'ShellExecuteEx',
                'SHEmptyRecycleBin', 'SHExpandEnvironmentStringsAlloc', 'SHFileOperation', 'SHForwardContextMenuMsg',
                'SHGetNoAssocIconIndex', 'SHGetSizeShared', 'SHGetUserDisplayName', 'SHGetUserPicturePath',
                'SHGetUserPicturePathEx', 'SHHelpShortcut_RunDLL', 'SHHelpShortcuts_RunDLL', 'SHInvokeCommandOnContextMenu',
                'SHInvokeCommandOnContextMenuEx', 'SHInvokeCommandsOnContextMenuEx', 'SHInvokeCommandWithFlagsAndSite',
                'SHLoadInProc', 'ShortSizeFormatExport', 'ShowConsoleCursor', 'SHRegSetValue', 'SHResolveUserNames',
                'SHSettingsChanged', 'SHSetUserPicturePath', 'SHShouldShowWizards', 'SHTestTokenPrivilegeW',
                'SHUnicodeToAnsiCPAlloc', 'shutdown', 'SignerAddTimeStampResponse', 'SignerAddTimeStampResponseEx',
                'SignerCreateTimeStampRequest', 'SignerFreeSignerContext', 'SignError', 'SignerSign', 'SignerSignEx',
                'SignerTimeStamp', 'SignerTimeStampEx', 'SignerTimeStampEx2', 'SisCreateBackupStructure',
                'SisCreateRestoreStructure', 'SisCSFilesToBackupForLink', 'SisFreeAllocatedMemory', 'SisFreeBackupStructure',
                'SisFreeRestoreStructure', 'SisRestoredCommonStoreFile', 'SisRestoredLink', 'SizeofResource', 'Sleep',
                'SleepEx', 'SNB_UserFree', 'SnmpCleanup', 'SnmpClose', 'SnmpConveyAgentAddress', 'SnmpGetRetransmitMode',
                'SnmpGetRetry', 'SnmpGetTimeout', 'SnmpGetTranslateMode', 'SnmpGetVendorInfo', 'SnmpOpen', 'SnmpRecvMsg',
                'SnmpRegister', 'SnmpSendMsg', 'SnmpSetAgentAddress', 'SnmpSetRetransmitMode', 'SnmpSetRetry', 'SnmpSetTimeout',
                'SnmpSetTranslateMode', 'SnmpStartup', 'socket', 'socket', 'SpcGetCertFromKey', 'SplitSymbols',
                'SQLConfigDriver', 'SQLConfigDriver', 'SQLConnect', 'SQLCopyDesc', 'SQLCreateDataSource', 'SQLCreateDataSource',
                'SQLCreateDataSourceEx', 'SQLDrivers', 'SQLDrivers', 'SQLEndTran', 'SQLExecDirect', 'SQLExecute',
                'SQLGetAvailableDrivers', 'SQLGetConfigMode', 'SQLGetConnectAttr', 'SQLGetConnectOption', 'SQLGetData',
                'SQLGetFunctions', 'SQLGetInstalledDrivers', 'SQLGetPrivateProfileString', 'SQLGetTranslator',
                'SQLInstallDriver', 'SQLInstallDriverEx', 'SQLInstallDriverManager', 'SQLInstallerError', 'SQLInstallODBC',
                'SQLInstallTranslator', 'SQLInstallTranslatorEx', 'SQLLoadDataSourcesListBox', 'SQLLoadDriverListBox',
                'SQLManageDataSources', 'SQLNativeSql', 'SQLPostInstallerError', 'SQLProcedures', 'SQLReadFileDSN',
                'SQLRemoveDefaultDataSource', 'SQLRemoveDriver', 'SQLRemoveDriverManager', 'SQLRemoveDSNFromIni',
                'SQLRemoveTranslator', 'SQLSetConfigMode', 'SQLSetConnectAttr', 'SQLTables', 'SQLTables', 'SQLTransact',
                'SQLValidDSN', 'SQLWriteDSNToIni', 'SQLWriteFileDSN', 'SQLWritePrivateProfileString', 'StackWalk',
                'StackWalk64', 'StackWalk64', 'StackWalk64', 'StartService', 'StartServiceCtrlDispatcher', 'StartTrace',
                'StgCreateDocfile', 'StgCreateStorageEx', 'StgOpenStorage', 'StringFromGUID2', 'SuspendThread',
                'SuspendThread', 'SwapMouseButton', 'SwitchDesktop', 'SwitchToFiber', 'SwitchToThisWindow',
                'SwitchToThread', 'SymCleanup', 'SymCleanup', 'SymCleanup', 'SymEnumerateSymbolsW', 'SymEnumSym',
                'SymEnumSym', 'SymFromAddr', 'SymFromAddr', 'SymFromAddr', 'SymFunctionTableAccess64',
                'SymFunctionTableAccess64', 'SymFunctionTableAccess64', 'SymGetModuleBase64', 'SymGetModuleBase64',
                'SymGetModuleBase64', 'SymGetModuleInfo64', 'SymGetModuleInfoW64', 'SymGetModuleInfoW64', 'SymGetOptions',
                'SymGetOptions', 'SymGetSymFromName', 'SymGetSymFromName', 'SymInitialize', 'SymInitialize', 'SymInitialize',
                'SymLoadModule64', 'SymLoadModule64', 'SymLoadModuleEx', 'SymRegisterCallback64', 'SymRegisterCallback64',
                'SymSetOptions', 'SymSetOptions', 'SymUnloadModule64', 'SymUnloadModule64', 'system', 'SystemFunction001',
                'SystemFunction002', 'SystemFunction003', 'SystemFunction004', 'SystemFunction005', 'SystemFunction028',
                'SystemFunction029', 'SystemFunction034', 'SystemFunction036', 'SystemFunction040', 'SystemFunction041',
                
                'TerminateProcess', 'TerminateThread', 'TestingServ', 'Thread32First', 'Thread32Next', 'ThunRTMain',
                'timeGetTime', 'timeGetTime', 'TlsGetValue', 'TlsSetValue', 'Toolhelp32ReadProcessMemory', 'TouchFileTimes',
                'TraceReturn', 'TraceSQLCancel', 'TraceSQLConnect', 'TraceVersion', 'TransactNamedPipe',
                'TreeResetNamedSecurityInfo', 'TreeSetNamedSecurityInfo',
                
                'UDPSend', 'UnDecorateSymbolName', 'UnenableRouter', 'UnhandledExceptionFilter', 'UnhookWindowsHookEx',
                'UnhookWinEvent', 'UnloadUserProfile', 'UnlockFile', 'UnlockFileEx', 'UnlockServiceDatabase',
                'UnlockWindowStation', 'UnMapAndLoad', 'UnmapDebugInformation', 'UnmapViewOfFile', 'UnpackDDElParam',
                'UnregisterDeviceNotification', 'UnregisterGPNotification', 'UnregisterHotKey', 'UnregisterTraceGuids',
                'UnregisterUserApiHook', 'UnsealMessage', 'UpdateDebugInfoFile', 'UpdateDebugInfoFileEx', 'UpdateResource',
                'UrlCreateFromPath', 'URLDownloadToFile', 'UrlEscape', 'UrlMkSetSessionOption', 'UrlZonesDetach', 'UTRegister',
                'UTUnRegister', 'UuidCreate', 'UuidCreateSequential', 'UuidToString',
                
                'ValidatePowerPolicies', 'VerifyConsoleIoHandle', 'VerifySignature', 'VerInstallFile', 'VerSetConditionMask',
                'VirtualAlloc', 'VirtualAllocEx', 'VirtualFree', 'VirtualFreeEx', 'VirtualProtect', 'VirtualProtectEx',
                'VirtualQuery', 'VirtualQueryEx', 'VirtualUnlock', 'VkKeyScan',
                
                'WaitForDebugEvent', 'WaitForThreadpoolTimerCallbacks', 'WaitMessage', 'WaitNamedPipe', 'WaitNamedPipe',
                'WCSToMBEx', 'WerReportSQMEvent', 'WinDetectHiddenText', 'WinExec', 'WinHelp', 'WinHttpAddRequestHeaders',
                'WinHttpCloseHandle', 'WinHttpConnect', 'WinHttpGetIEProxyConfigForCurrentUser', 'WinHttpGetProxyForUrl',
                'WinHttpOpen', 'WinHttpOpenRequest', 'WinHttpQueryDataAvailable', 'WinHttpQueryHeaders', 'WinHttpReadData',
                'WinHttpReceiveResponse', 'WinHttpSendRequest', 'WinHttpSetOption', 'WinHttpSetStatusCallback',
                'WinHttpWriteData', 'WinSearchChildren', 'WinSqmAddToAverageDWORD', 'WinSqmAddToStream', 'WinSqmAddToStreamEx',
                'WinSqmCheckEscalationAddToStreamEx', 'WinSqmCheckEscalationSetDWORD', 'WinSqmCheckEscalationSetDWORD64',
                'WinSqmCheckEscalationSetString', 'WinSqmCommonDatapointDelete', 'WinSqmCommonDatapointSetDWORD',
                'WinSqmCommonDatapointSetDWORD64', 'WinSqmCommonDatapointSetStreamEx', 'WinSqmCommonDatapointSetString',
                'WinSqmEndSession', 'WinSqmEventEnabled', 'WinSqmEventWrite', 'WinSqmGetEscalationRuleStatus',
                'WinSqmGetInstrumentationProperty', 'WinSqmIncrementDWORD', 'WinSqmIsOptedIn', 'WinSqmIsOptedInEx',
                'WinSqmSetDWORD', 'WinSqmSetDWORD64', 'WinSqmSetEscalationInfo', 'WinSqmSetIfMaxDWORD', 'WinSqmSetIfMinDWORD',
                'WinSqmSetString', 'WinSqmStartSession', 'WinStationGetLoggedOnCount', 'WinStationQueryInformation',
                'WinStationSendMessage', 'WinTextMatchMode', 'WinTitleMatchMode', 'WinVerifyTrust', 'WinWaitDelay',
                'WlanCloseHandle', 'WlanEnumInterfaces', 'WlanGetAvailableNetworkList', 'WlanOpenHandle', 'WlanQueryInterface',
                'WlxActivateUserShell', 'WlxDisconnectNotify', 'WlxDisplayLockedNotice', 'WlxDisplaySASNotice',
                'WlxDisplayStatusMessage', 'WlxGetConsoleSwitchCredentials', 'WlxGetStatusMessage', 'WlxInitialize',
                'WlxIsLockOk', 'WlxIsLogoffOk', 'WlxLoggedOnSAS', 'WlxLoggedOnSAS', 'WlxLoggedOutSAS', 'WlxLogoff',
                'WlxNegotiate', 'WlxNetworkProviderLoad', 'WlxReconnectNotify', 'WlxRemoveStatusMessage',
                'WlxScreenSaverNotify', 'WlxShutdown', 'WlxStartApplication', 'WlxWkstaLockedSAS', 'WmiCloseBlock',
                'WmiFileHandleToInstanceName', 'WNetAddConnection2', 'WNetAddConnection2', 'WNetAddConnection3',
                'WNetCancelConnection', 'WNetCancelConnection2', 'WNetCloseEnum', 'WNetEnumResource', 'WNetGetConnection',
                'WNetGetConnection', 'WNetGetNetworkInformation', 'WNetGetProviderName', 'WNetGetResourceInformation',
                'WNetGetResourceParent', 'WNetGetUniversalName', 'WNetGetUser', 'WNetOpenEnum', 'WNetRestoreConnection',
                'WNetUseConnection', 'WNetUseConnection', 'Wow64DisableWow64FsRedirection', 'Wow64GetThreadContext',
                'Wow64SuspendThread', 'WriteConfigString', 'WriteConsole', 'WriteConsoleInput', 'WriteConsoleOutput',
                'WriteConsoleOutputCharacter', 'WriteEncryptedFileRaw', 'WriteFile', 'WriteFileEx', 'WriteGlobalPwrPolicy',
                'WriteHitLogging', 'WriteHitLogging', 'WritePrivateProfileSection', 'WritePrivateProfileString',
                'WritePrivateProfileStruct', 'WriteProcessMemory', 'WriteProcessorPwrScheme', 'WriteProfileSection',
                'WriteProfileString', 'WritePwrScheme', 'WriteTapemark', 'WSAAccept', 'WSAAddressToString',
                'WSAAsyncGetProtoByNumber', 'WSAAsyncGetServByName', 'WSAAsyncSelect', 'WSACancelAsyncRequest',
                'WSACancelBlockingCall', 'WSACleanup', 'WSACloseEvent', 'WSAConnect', 'WSACreateEvent',
                'WSADeleteSocketPeerTargetName', 'WSAEnumNameSpaceProviders', 'WSAEnumNetworkEvents', 'WSAEventSelect',
                'WSAGetLastError', 'WSAGetOverlappedResult', 'WSAImpersonateSocketPeer', 'WSAIoctl', 'WSALookupServiceBegin',
                'WSALookupServiceNext', 'WSALookupServiceNext', 'WSAQuerySocketSecurity', 'WSARecv', 'WSARecv', 'WSARecvEx',
                'WSARecvEx', 'WSARecvFrom', 'WSARevertImpersonation', 'WSASend', 'WSASetLastError', 'WSASetService',
                'WSASetSocketPeerTargetName', 'WSASocket', 'WSAStartup', 'WSAStringToAddress', 'WSAStringToAddress',
                'WSAUnhookBlockingHook', 'WSHAddressToString', 'WSHEnumProtocols', 'WSHGetProviderGuid', 'WSHGetSockaddrType',
                'WSHGetSocketInformation', 'WSHGetWildcardSockaddr', 'WSHGetWinsockMapping', 'WSHGetWSAProtocolInfo',
                'WSHIoctl', 'WSHJoinLeaf', 'WSHNotify', 'WSHOpenSocket', 'WSHOpenSocket2', 'WSHSetSocketInformation',
                'WSHStringToAddress', 'WTHelperGetProvSignerFromChain', 'WTHelperProvDataFromStateData', 'WTSCloseServer',
                'WTSConnectSession', 'WTSCreateListener', 'WTSEnumerateProcesses', 'WTSEnumerateServers', 'WTSEnumerateServers',
                'WTSEnumerateSessions', 'WTSFreeMemory', 'WTSGetActiveConsoleSessionId', 'WTSLogoffSession',
                'WTSQuerySessionInformation', 'WTSQueryUserToken', 'WTSRegisterSessionNotification',
                'WTSRegisterSessionNotificationEx', 'WTSSendMessage', 'WTSSetSessionInformation',
                'WTSStartRemoteControlSession', 'WTSUnRegisterSessionNotification', 'WTSVirtualChannelOpen',
                
                'ZwCallbackReturn', 'ZwCreateFile', 'ZwDeleteFile', 'ZwDuplicateToken', 'ZwEnumerateKey', 'ZwEnumerateKey',
                'ZwFlushKey', 'ZwMapViewOfSection', 'ZwOpenProcess', 'ZwOpenProcess', 'ZwOpenProcessToken',
                'ZwProtectVirtualMemory', 'ZwQueryInformationProcess', 'ZwQueryInformationToken', 'ZwQuerySystemInformation',
                'ZwReadVirtualMemory', 'ZwRequestPort', 'ZwResumeThread', 'ZwSaveKey', 'ZwSaveKeyEx', 'ZwSetLdtEntries',
                'ZwTerminateProcess', 'ZwUnmapViewOfSection', 'ZwWriteFile', 'ZwWriteVirtualMemory']

class PeFile(IPlugin, Processing):
    
    def run(self, objfile):
        self.key = "PeFile"
        self.score = 0
        returnValue = {}

        try:
            pe = PE(data=objfile.file.file_data)
                        
            returnValue["PeChecksum"] = self.peChecksum(pe)
            returnValue["PeEntryPoint"] = self.peCheckEP(pe)
            returnValue["PeTlsCallbacks"] = self.checkTlsCallbacks(pe)
            returnValue["PeSections"] = self.peSectionInformations(pe)
            returnValue["Imports"] = self.peImports(pe)
            returnValue["PeRSRC"] = self.peRSRC(pe)
            returnValue["PeTimestamp"] = self.peTimestamp(pe)
            returnValue["PeSuspiciousApiFunctions"] = self.peSuspiciousApiFunctions(pe)
            returnValue["PeCheckAntiDBG"] = self.peCheckAntiDBG(pe)
            returnValue["PeVersionsInfo"] = self.peVersionInfo(pe)
            returnValue["PeCheckAntiVM"] = self.peCheckAntiVM(objfile.file.temp_file)
            returnValue["PeDebugInformation"] = self.peDebugInformation(pe)
        except PEFormatError, e:
            log.warn("Error - No Portable Executable: %s" % e) 
        
        return returnValue
    
    def peVersionInfo(self, pe):
        """Get version info.
        @return: info dict or None.
        """

        infos = []
        if hasattr(pe, "VS_VERSIONINFO"):
            if hasattr(pe, "FileInfo"):
                for entry in pe.FileInfo:
                    try:
                        if hasattr(entry, "StringTable"):
                            for st_entry in entry.StringTable:
                                for str_entry in st_entry.entries.items():
                                    entry = {}
                                    entry["name"] = str_entry[0]
                                    entry["value"] = str_entry[1]
                                    infos.append(entry)
                        elif hasattr(entry, "Var"):
                            for var_entry in entry.Var:
                                if hasattr(var_entry, "entry"):
                                    entry = {}
                                    entry["name"] = var_entry.entry.keys()[0]
                                    entry["value"] = var_entry.entry.values()[0]
                                    infos.append(entry)
                    except:
                        continue

        return infos
    
    def peDebugInformation(self, pe):
        try:
            return pe.DIRECTORY_ENTRY_DEBUG[0].struct
        except:
            try:
                return pe.DIRECTORY_ENTRY_DEBUG.struct
            except:
                try:
                    return pe.DIRECTORY_ENTRY_DEBUG
                except:
                    return None    
    
    def peSuspiciousApiFunctions(self, pe):
        apiFunctions = []
       
        for lib in pe.DIRECTORY_ENTRY_IMPORT:
                for imp in lib.imports:
                    if (imp.name != None) and (imp.name != ""):
                        if imp.name in API_FUNCTIONS:
                            apiFunctions.append(imp.name)
                                
        countApiFunctions = len(apiFunctions)
        
        if countApiFunctions > 2 and countApiFunctions < 5:
            self.score += 5
        elif countApiFunctions > 5:
            self.score += 8
        elif countApiFunctions > 10:
            self.score += 10
    
        return sorted(apiFunctions)
    
    def peCheckAntiVM(self, temp_file):
        antiVMTricks = []
        CountTricks = 0
        
        with open(temp_file, "rb") as f:
            buf = f.read()
            for trick in VM_SIGN:
                if buf.find(VM_SIGN[trick][::-1]) > -1:
                    log.debug("Anti VM:\t", trick)
                    antiVMTricks.append(trick)
                    CountTricks = CountTricks + 1
        
        if CountTricks == 0:
            log.debug("Anti VM:\tNone")
            antiVMTricks.append("None")
        else:
            self.score += 10
        
        return antiVMTricks
    
    def peCheckAntiDBG(self, pe):
        returnValue = {}
        antiDbgApi = []
        
        for lib in pe.DIRECTORY_ENTRY_IMPORT:
                for imp in lib.imports:
                    if (imp.name != None) and (imp.name != ""):
                        for antidbg in ANTI_DBGS:
                            if imp.name.startswith(antidbg):
                                antiDbgApi.append(imp.name)
        
        if len(antiDbgApi) > 0:
            self.score = 8
            returnValue = {'Anti_Debug' : 'Yes', 'API_Anti_Debug' : antiDbgApi}
        else:
            returnValue = {'Anti_Debug' : 'No', 'API_Anti_Debug' : ['No suspicious API Anti Debug']}
            
        return returnValue
    
    def peChecksum(self, pe):
        suspicious = False
        claimed = hex(pe.OPTIONAL_HEADER.CheckSum)
        actual = hex(pe.generate_checksum())
        
        if actual != claimed:
            suspicious = True
            self.score += 10
            
        log.info("Claimed: %s, Actual: %s %s" % 
                (claimed, actual, "[SUSPICIOUS]" if suspicious else ""))

        return {'Claimed':claimed,
                'Actual':actual,
                'Suspicious':suspicious}
    
    def checkTlsCallbacks(self, pe):
        tlsAdresses = []
        callbacks = self.getTlsCallbacks(pe)
        
        if len(callbacks):
            self.score += 10
            log.info("TLS callbacks")
            
            for cb in callbacks:
                tlsAdresses.append(hex(cb))
          
        return tlsAdresses
    
    def getTlsCallbacks(self, pe):
        callbacks = []
        if (hasattr(pe, 'DIRECTORY_ENTRY_TLS') and \
                    pe.DIRECTORY_ENTRY_TLS and \
                    pe.DIRECTORY_ENTRY_TLS.struct and \
                    pe.DIRECTORY_ENTRY_TLS.struct.AddressOfCallBacks):
            callback_array_rva = pe.DIRECTORY_ENTRY_TLS.struct.AddressOfCallBacks - pe.OPTIONAL_HEADER.ImageBase 
            idx = 0
            while True:
                func = pe.get_dword_from_data(pe.get_data(callback_array_rva + 4 * idx, 4), 0)
                if func == 0: 
                    break
                callbacks.append(func)
                idx += 1
        return callbacks
    
    def peCheckEP(self, pe):
        suspicious = False
        (ep, name, pos) = self.getEPSection(pe)
        posVsSections = "%d/%d" % (pos, len(pe.sections))
        
        if (name not in GOOD_EP_SECTIONS) or pos == len(pe.sections):
            self.score += 10
            suspicious = True
            
        returnValue = {'EP':hex(ep + pe.OPTIONAL_HEADER.ImageBase),
                       'Name':name,
                       'posVsSections':posVsSections,
                       'Suspicious':suspicious}
            
        return returnValue
        
    def getEPSection(self, pe):
        """ Determine if a PE's entry point is suspicious """
        name = ''
        ep = pe.OPTIONAL_HEADER.AddressOfEntryPoint
        pos = 0
        for sec in pe.sections:
            if (ep >= sec.VirtualAddress) and \
               (ep < (sec.VirtualAddress + sec.Misc_VirtualSize)):
                name = sec.Name.replace('\x00', '')
                break
            else: 
                pos += 1
        return (ep, name, pos)
    
    def peTimestamp(self, pe):
        peTimeDateStamp = pe.FILE_HEADER.TimeDateStamp
        timeStamp = '0x%-8X' % (peTimeDateStamp)
        try:
            timeStamp += ' [%s UTC]' % time.asctime(time.gmtime(peTimeDateStamp))
            peYear = time.gmtime(peTimeDateStamp)[0]
            thisYear = time.gmtime(time.time())[0]
            if peYear < 2000 or peYear > thisYear:
                timeStamp += " [SUSPICIOUS]"
                self.score += 10
        except:
            timeStamp += ' [SUSPICIOUS]'
            self.score += 10
        
        return timeStamp    
    
    def peSectionInformations(self, pe):
        returnValue = {}
        returnValue["NumberOfSections"] = pe.FILE_HEADER.NumberOfSections
        
        i = 0
        sections = []
        for section in pe.sections:
            i += 1
            info = {}
            sname = section.Name.replace("\x00", "")
            entropy = round(section.get_entropy(), 1)
            info["name"] = sname
            info["md5"] = section.get_hash_md5()                   
            info["virtualAddress"] = hex(section.VirtualAddress)
            info["virtualSize"] = hex(section.Misc_VirtualSize)
            info["sizeOfRawData"] = section.SizeOfRawData
            
            if section.SizeOfRawData == 0 or (entropy > 0 and entropy < 1) or entropy > 6.8:
                self.score += 10
                entropy = str(entropy) + " [SUSPICIOUS]"
               
            info["entropy"] = entropy     
            sections.append(info)
                
        returnValue["Sections"] = sections    
            
        return returnValue
    
    def peImports(self, pe):
        returnValue = []
        
        for entry in pe.DIRECTORY_ENTRY_IMPORT:
            dll = {}
            dllImport = []
            for imp in entry.imports:
                if imp.name: dllImport.append(imp.name)
                
            dll["name"] = entry.dll
            dll["imports"] = sorted(dllImport)
            
            returnValue.append(dll) 
            
        return returnValue
    
    def peRSRC(self, pe):
        returnValue = []
        resources = self.getResources(pe)
        
        if len(resources):
            for rsrc in resources.keys():
                (name, rva, size, type, lang, sublang) = resources[rsrc]
                resource = {}
                resource["name"] = name
                resource["RVA"] = hex(rva)
                resource["Size"] = hex(size)
                resource["Lang"] = lang
                resource["Sublang"] = sublang
                resource["Type"] = type
                returnValue.append(resource)
                  
        return returnValue
    
    def getResources(self, pe):
        ret = {}
        if hasattr(pe, 'DIRECTORY_ENTRY_RESOURCE'):
            i = 0
            for resource_type in pe.DIRECTORY_ENTRY_RESOURCE.entries:
                if resource_type.name is not None:
                    name = "%s" % resource_type.name
                else:
                    name = "%s" % pefile.RESOURCE_TYPE.get(resource_type.struct.Id)
                if name == None:
                    name = "%d" % resource_type.struct.Id
                if hasattr(resource_type, 'directory'):
                    for resource_id in resource_type.directory.entries:
                        if hasattr(resource_id, 'directory'):
                            for resource_lang in resource_id.directory.entries:
                                data = pe.get_data(resource_lang.data.struct.OffsetToData, resource_lang.data.struct.Size)
                                filetype = getFileTypeFromBuffer(data)
                                lang = pefile.LANG.get(resource_lang.data.lang, '*unknown*')
                                sublang = pefile.get_sublang_name_for_lang(resource_lang.data.lang, resource_lang.data.sublang)
                                ret[i] = (name, resource_lang.data.struct.OffsetToData, resource_lang.data.struct.Size, filetype, lang, sublang)
                                i += 1
        return ret
