#!/usr/bin/env python
import os
import sys

def downloadBySha256(sha256, dumpDir):

    if (len(sha256) != 64):
        print "This is not a sha256!\n"
        return 0

    if os.path.isfile(dumpDir + sha256):
        print "Error: File %s already exists." % sha256
        return 0
    
    cmd = "wget -q --tries=1 --directory-prefix=%s 'http://localhost:8080/malware/get/%s'" % (dumpDir,sha256)
    os.system(cmd)
    print cmd

    if not os.path.isfile(dumpDir + sha256):
        print "Error: Download %s failed." % sha256
        return 0
        
if __name__=="__main__":
    
    if (len(sys.argv) != 2):
        print "Usage: ",__file__,"<sha256-file> <dump-dir> (eg. 'python exportVxCage.py export.txt /home/user/Download/Malware')\n" 
        
        sha256File = sys.argv[1] or ""
        dumpDir = sys.argv[2] or ""
        dumpDir = os.path.normpath(dumpDir) + os.sep
        
        file = open(sha256File,"r")
        for sha256 in file:
            downloadBySha256(sha256.rstrip(), dumpDir)
        file.close()

    print "Success."
    sys.exit()